{
    "sourceFile": "frontend/src/pages/Dashboard.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 15,
            "patches": [
                {
                    "date": 1762431573360,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762431599409,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,219 @@\n // frontend/src/pages/Dashboard.js\r\n+\r\n+import React, { useState, useRef } from 'react';\r\n+import axios from 'axios';\r\n+\r\n+const Dashboard = () => {\r\n+    const [file, setFile] = useState(null);\r\n+    const [analysisResult, setAnalysisResult] = useState(null);\r\n+    const [message, setMessage] = useState('');\r\n+    const [isLoading, setIsLoading] = useState(false);\r\n+    const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n+    const [rewritingIndex, setRewritingIndex] = useState(null);\r\n+    const fileInputRef = useRef(null);\r\n+\r\n+    // Retrieve JWT token from localStorage\r\n+    const getAuthToken = () => {\r\n+        try {\r\n+            const user = JSON.parse(localStorage.getItem('user'));\r\n+            return user?.token || null;\r\n+        } catch {\r\n+            return null;\r\n+        }\r\n+    };\r\n+\r\n+    const onFileChange = e => {\r\n+        setFile(e.target.files[0]);\r\n+    };\r\n+\r\n+    const onFormSubmit = async e => {\r\n+        e.preventDefault();\r\n+        setIsLoading(true);\r\n+        setMessage('Uploading and analyzing...');\r\n+        setAnalysisResult(null);\r\n+        setRewriteSuggestions({});\r\n+\r\n+        if (!file) {\r\n+            setMessage('Please select a file first.');\r\n+            setIsLoading(false);\r\n+            return;\r\n+        }\r\n+\r\n+        try {\r\n+            const token = getAuthToken();\r\n+            if (!token) {\r\n+                setMessage('Authorization error. Please log in again.');\r\n+                setIsLoading(false);\r\n+                return;\r\n+            }\r\n+\r\n+            const formData = new FormData();\r\n+            formData.append('document', file);\r\n+\r\n+            const config = {\r\n+                headers: {\r\n+                    'Content-Type': 'multipart/form-data',\r\n+                    'x-auth-token': token\r\n+                },\r\n+                timeout: 30000\r\n+            };\r\n+\r\n+            const response = await axios.post(\r\n+                'http://localhost:5000/api/documents/upload',\r\n+                formData,\r\n+                config\r\n+            );\r\n+\r\n+            setAnalysisResult(response.data);\r\n+            setMessage('Analysis Complete!');\r\n+        } catch (error) {\r\n+            console.error('File upload error:', error);\r\n+            setMessage('Analysis failed. Please re-login or retry.');\r\n+        } finally {\r\n+            setIsLoading(false);\r\n+        }\r\n+    };\r\n+\r\n+    const handleRewrite = async (sentence, index) => {\r\n+        setRewritingIndex(index);\r\n+        try {\r\n+            const token = getAuthToken();\r\n+            if (!token) {\r\n+                setRewriteSuggestions(prev => ({ ...prev, [index]: \"Authorization error.\" }));\r\n+                return;\r\n+            }\r\n+\r\n+            const config = {\r\n+                headers: {\r\n+                    'Content-Type': 'application/json',\r\n+                    'x-auth-token': token\r\n+                },\r\n+                timeout: 20000\r\n+            };\r\n+\r\n+            const response = await axios.post(\r\n+                'http://localhost:5000/api/documents/rewrite',\r\n+                { sentence },\r\n+                config\r\n+            );\r\n+\r\n+            setRewriteSuggestions(prev => ({\r\n+                ...prev,\r\n+                [index]: response.data.rewritten_text\r\n+            }));\r\n+        } catch (error) {\r\n+            console.error('Rewrite error:', error);\r\n+            setRewriteSuggestions(prev => ({\r\n+                ...prev,\r\n+                [index]: \"Error getting suggestion.\"\r\n+            }));\r\n+        } finally {\r\n+            setRewritingIndex(null);\r\n+        }\r\n+    };\r\n+\r\n+    const handleClear = () => {\r\n+        setFile(null);\r\n+        setAnalysisResult(null);\r\n+        setMessage('');\r\n+        setRewriteSuggestions({});\r\n+        if (fileInputRef.current) {\r\n+            fileInputRef.current.value = \"\";\r\n+        }\r\n+    };\r\n+\r\n+    return (\r\n+        <div className=\"container mx-auto mt-10 p-4\">\r\n+            <div className=\"w-full max-w-2xl mx-auto p-6 sm:p-8 space-y-6 bg-white rounded-lg shadow-md\">\r\n+                <h2 className=\"text-2xl font-bold text-center\">Dashboard</h2>\r\n+                <form onSubmit={onFormSubmit} className=\"space-y-4\">\r\n+                    <div>\r\n+                        <label htmlFor=\"file-upload\" className=\"block text-sm font-medium text-gray-700\">\r\n+                            Upload your document\r\n+                        </label>\r\n+                        <div className=\"mt-1 flex items-center\">\r\n+                            <input\r\n+                                type=\"file\"\r\n+                                ref={fileInputRef}\r\n+                                onChange={onFileChange}\r\n+                                disabled={isLoading}\r\n+                                className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 \r\n+                                           file:rounded-full file:border-0 file:text-sm file:font-semibold \r\n+                                           file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 \r\n+                                           disabled:opacity-50\"\r\n+                            />\r\n+                        </div>\r\n+                    </div>\r\n+                    <button\r\n+                        type=\"submit\"\r\n+                        disabled={isLoading}\r\n+                        className=\"w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md \r\n+                                   hover:bg-indigo-700 focus:outline-none focus:ring-2 \r\n+                                   focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 \r\n+                                   disabled:cursor-not-allowed\"\r\n+                    >\r\n+                        {isLoading ? 'Analyzing...' : 'Upload & Analyze'}\r\n+                    </button>\r\n+                </form>\r\n+\r\n+                {message && !isLoading && (\r\n+                    <p className=\"text-center text-sm text-gray-600 mt-4\">{message}</p>\r\n+                )}\r\n+            </div>\r\n+\r\n+            {analysisResult && (\r\n+                <div className=\"w-full max-w-2xl mx-auto mt-8 p-6 sm:p-8 bg-white rounded-lg shadow-md\">\r\n+                    <div className=\"flex justify-between items-center mb-4\">\r\n+                        <h3 className=\"text-xl font-bold\">Analysis Report</h3>\r\n+                        <button\r\n+                            onClick={handleClear}\r\n+                            className=\"px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200\"\r\n+                        >\r\n+                            Clear\r\n+                        </button>\r\n+                    </div>\r\n+                    <p className=\"text-lg mb-4\">\r\n+                        <strong>Overall Plagiarism Score:</strong> {analysisResult.overall_score}%\r\n+                    </p>\r\n+                    <h4 className=\"text-lg font-semibold mb-2\">Flagged Sections:</h4>\r\n+                    <div className=\"space-y-4\">\r\n+                        {analysisResult.flagged_sections.length > 0 ? (\r\n+                            analysisResult.flagged_sections.map((section, index) => (\r\n+                                <div key={index} className=\"border border-gray-200 p-4 rounded-md\">\r\n+                                    <p className=\"text-gray-700 italic\">\"{section.text}\"</p>\r\n+                                    <p className=\"text-sm mt-2\">\r\n+                                        <strong>Source:</strong> <span className=\"text-gray-600\">{section.source}</span>\r\n+                                    </p>\r\n+                                    <p className=\"text-sm\">\r\n+                                        <strong>Similarity:</strong>{' '}\r\n+                                        <span className=\"font-semibold text-indigo-600\">\r\n+                                            {section.similarity}% ({section.type})\r\n+                                        </span>\r\n+                                    </p>\r\n+                                    <div className=\"mt-3\">\r\n+                                        <button\r\n+                                            onClick={() => handleRewrite(section.text, index)}\r\n+                                            disabled={rewritingIndex === index}\r\n+                                            className=\"text-sm font-medium text-indigo-600 hover:text-indigo-800 disabled:opacity-50 disabled:cursor-wait\"\r\n+                                        >\r\n+                                            {rewritingIndex === index ? 'Generating...' : 'âœ¨ Suggest Rewrite'}\r\n+                                        </button>\r\n+                                        {rewriteSuggestions[index] && (\r\n+                                            <div className=\"mt-2 p-3 bg-indigo-50 rounded-md\">\r\n+                                                <p className=\"text-sm text-gray-800\">{rewriteSuggestions[index]}</p>\r\n+                                            </div>\r\n+                                        )}\r\n+                                    </div>\r\n+                                </div>\r\n+                            ))\r\n+                        ) : (\r\n+                            <p className=\"text-gray-500\">No plagiarized sections found.</p>\r\n+                        )}\r\n+                    </div>\r\n+                </div>\r\n+            )}\r\n+        </div>\r\n+    );\r\n+};\r\n+\r\n+export default Dashboard;\r\n"
                },
                {
                    "date": 1762435164885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n // frontend/src/pages/Dashboard.js\r\n \r\n+\r\n import React, { useState, useRef } from 'react';\r\n import axios from 'axios';\r\n \r\n const Dashboard = () => {\r\n"
                },
                {
                    "date": 1762435172131,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n // frontend/src/pages/Dashboard.js\r\n+import PlagiarismResult from \"../components/PlagiarismResult\";\r\n \r\n-\r\n import React, { useState, useRef } from 'react';\r\n import axios from 'axios';\r\n \r\n const Dashboard = () => {\r\n"
                },
                {
                    "date": 1762435525967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,350 @@\n // frontend/src/pages/Dashboard.js\r\n-import PlagiarismResult from \"../components/PlagiarismResult\";\r\n+import React, { useState, useRef } from \"react\";\r\n+import axios from \"axios\";\r\n+import { Doughnut } from \"react-chartjs-2\";\r\n+import \"chart.js/auto\";\r\n \r\n+const Dashboard = () => {\r\n+  const [file, setFile] = useState(null);\r\n+  const [analysisResult, setAnalysisResult] = useState(null);\r\n+  const [message, setMessage] = useState(\"\");\r\n+  const [isLoading, setIsLoading] = useState(false);\r\n+  const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n+  const [rewritingIndex, setRewritingIndex] = useState(null);\r\n+  const fileInputRef = useRef(null);\r\n+\r\n+  // Retrieve JWT token from localStorage\r\n+  const getAuthToken = () => {\r\n+    try {\r\n+      const user = JSON.parse(localStorage.getItem(\"user\"));\r\n+      return user?.token || null;\r\n+    } catch {\r\n+      return null;\r\n+    }\r\n+  };\r\n+\r\n+  const onFileChange = (e) => {\r\n+    setFile(e.target.files[0]);\r\n+  };\r\n+\r\n+  const onFormSubmit = async (e) => {\r\n+    e.preventDefault();\r\n+    setIsLoading(true);\r\n+    setMessage(\"Uploading and analyzing...\");\r\n+    setAnalysisResult(null);\r\n+    setRewriteSuggestions({});\r\n+\r\n+    if (!file) {\r\n+      setMessage(\"Please select a file first.\");\r\n+      setIsLoading(false);\r\n+      return;\r\n+    }\r\n+\r\n+    try {\r\n+      const token = getAuthToken();\r\n+      if (!token) {\r\n+        setMessage(\"Authorization error. Please log in again.\");\r\n+        setIsLoading(false);\r\n+        return;\r\n+      }\r\n+\r\n+      const formData = new FormData();\r\n+      formData.append(\"document\", file);\r\n+\r\n+      const config = {\r\n+        headers: {\r\n+          \"Content-Type\": \"multipart/form-data\",\r\n+          \"x-auth-token\": token,\r\n+        },\r\n+        timeout: 30000,\r\n+      };\r\n+\r\n+      const response = await axios.post(\r\n+        \"http://localhost:5000/api/documents/upload\",\r\n+        formData,\r\n+        config\r\n+      );\r\n+\r\n+      setAnalysisResult(response.data);\r\n+      setMessage(\"Analysis Complete!\");\r\n+    } catch (error) {\r\n+      console.error(\"File upload error:\", error);\r\n+      setMessage(\"Analysis failed. Please re-login or retry.\");\r\n+    } finally {\r\n+      setIsLoading(false);\r\n+    }\r\n+  };\r\n+\r\n+  const handleRewrite = async (sentence, index) => {\r\n+    setRewritingIndex(index);\r\n+    try {\r\n+      const token = getAuthToken();\r\n+      if (!token) {\r\n+        setRewriteSuggestions((prev) => ({\r\n+          ...prev,\r\n+          [index]: \"Authorization error.\",\r\n+        }));\r\n+        return;\r\n+      }\r\n+\r\n+      const config = {\r\n+        headers: {\r\n+          \"Content-Type\": \"application/json\",\r\n+          \"x-auth-token\": token,\r\n+        },\r\n+        timeout: 20000,\r\n+      };\r\n+\r\n+      const response = await axios.post(\r\n+        \"http://localhost:5000/api/documents/rewrite\",\r\n+        { sentence },\r\n+        config\r\n+      );\r\n+\r\n+      setRewriteSuggestions((prev) => ({\r\n+        ...prev,\r\n+        [index]: response.data.rewritten_text,\r\n+      }));\r\n+    } catch (error) {\r\n+      console.error(\"Rewrite error:\", error);\r\n+      setRewriteSuggestions((prev) => ({\r\n+        ...prev,\r\n+        [index]: \"Error getting suggestion.\",\r\n+      }));\r\n+    } finally {\r\n+      setRewritingIndex(null);\r\n+    }\r\n+  };\r\n+\r\n+  const handleClear = () => {\r\n+    setFile(null);\r\n+    setAnalysisResult(null);\r\n+    setMessage(\"\");\r\n+    setRewriteSuggestions({});\r\n+    if (fileInputRef.current) {\r\n+      fileInputRef.current.value = \"\";\r\n+    }\r\n+  };\r\n+\r\n+  // Helper to highlight text\r\n+  const highlightSentence = (section) => {\r\n+    if (section.type === \"Direct Match\") {\r\n+      return (\r\n+        <span\r\n+          key={section.text}\r\n+          style={{ backgroundColor: \"#ff4d4d33\", color: \"#b30000\" }}\r\n+        >\r\n+          {section.text + \" \"}\r\n+        </span>\r\n+      );\r\n+    } else if (section.type === \"Paraphrased\") {\r\n+      return (\r\n+        <span\r\n+          key={section.text}\r\n+          style={{ backgroundColor: \"#fff2cc\", color: \"#b38f00\" }}\r\n+        >\r\n+          {section.text + \" \"}\r\n+        </span>\r\n+      );\r\n+    } else {\r\n+      return <span key={section.text}>{section.text + \" \"}</span>;\r\n+    }\r\n+  };\r\n+\r\n+  // Chart configuration\r\n+  const generateChartData = (sections) => {\r\n+    let direct = 0,\r\n+      paraphrased = 0,\r\n+      unique = 0;\r\n+\r\n+    sections.forEach((s) => {\r\n+      if (s.type === \"Direct Match\") direct++;\r\n+      else if (s.type === \"Paraphrased\") paraphrased++;\r\n+      else unique++;\r\n+    });\r\n+\r\n+    return {\r\n+      labels: [\"Direct\", \"Paraphrased\", \"Unique\"],\r\n+      datasets: [\r\n+        {\r\n+          data: [direct, paraphrased, unique],\r\n+          backgroundColor: [\"#ff4d4d\", \"#ffcc00\", \"#4caf50\"],\r\n+          borderWidth: 1,\r\n+        },\r\n+      ],\r\n+    };\r\n+  };\r\n+\r\n+  return (\r\n+    <div className=\"container mx-auto mt-10 p-4\">\r\n+      <div className=\"w-full max-w-2xl mx-auto p-6 sm:p-8 space-y-6 bg-white rounded-lg shadow-md\">\r\n+        <h2 className=\"text-2xl font-bold text-center\">Dashboard</h2>\r\n+        <form onSubmit={onFormSubmit} className=\"space-y-4\">\r\n+          <div>\r\n+            <label\r\n+              htmlFor=\"file-upload\"\r\n+              className=\"block text-sm font-medium text-gray-700\"\r\n+            >\r\n+              Upload your document\r\n+            </label>\r\n+            <div className=\"mt-1 flex items-center\">\r\n+              <input\r\n+                type=\"file\"\r\n+                ref={fileInputRef}\r\n+                onChange={onFileChange}\r\n+                disabled={isLoading}\r\n+                className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 \r\n+                             file:rounded-full file:border-0 file:text-sm file:font-semibold \r\n+                             file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 \r\n+                             disabled:opacity-50\"\r\n+              />\r\n+            </div>\r\n+          </div>\r\n+          <button\r\n+            type=\"submit\"\r\n+            disabled={isLoading}\r\n+            className=\"w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md \r\n+                       hover:bg-indigo-700 focus:outline-none focus:ring-2 \r\n+                       focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 \r\n+                       disabled:cursor-not-allowed\"\r\n+          >\r\n+            {isLoading ? \"Analyzing...\" : \"Upload & Analyze\"}\r\n+          </button>\r\n+        </form>\r\n+\r\n+        {message && !isLoading && (\r\n+          <p className=\"text-center text-sm text-gray-600 mt-4\">{message}</p>\r\n+        )}\r\n+      </div>\r\n+\r\n+      {analysisResult && (\r\n+        <div className=\"w-full max-w-6xl mx-auto mt-8 p-6 sm:p-8 bg-white rounded-lg shadow-md\">\r\n+          <div className=\"flex justify-between items-center mb-4\">\r\n+            <h3 className=\"text-xl font-bold\">Analysis Report</h3>\r\n+            <button\r\n+              onClick={handleClear}\r\n+              className=\"px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200\"\r\n+            >\r\n+              Clear\r\n+            </button>\r\n+          </div>\r\n+          <p className=\"text-lg mb-4\">\r\n+            <strong>Overall Plagiarism Score:</strong>{\" \"}\r\n+            {analysisResult.overall_score}%\r\n+          </p>\r\n+\r\n+          {/* Donut Chart + Highlighted Text */}\r\n+          <div className=\"flex flex-col lg:flex-row gap-6\">\r\n+            {/* Left side: Highlighted Original Text */}\r\n+            <div className=\"flex-1 bg-gray-50 p-4 rounded-md max-h-[70vh] overflow-y-auto shadow-sm\">\r\n+              <h3 className=\"text-lg font-semibold mb-2\">Uploaded Document</h3>\r\n+              <p className=\"text-gray-800 leading-7 text-justify\">\r\n+                {analysisResult.document_visualizer?.map((section, index) => (\r\n+                  <React.Fragment key={index}>\r\n+                    {highlightSentence(section)}\r\n+                  </React.Fragment>\r\n+                ))}\r\n+              </p>\r\n+            </div>\r\n+\r\n+            {/* Right side: Donut Chart */}\r\n+            <div className=\"w-full lg:w-1/3 bg-white p-4 rounded-md shadow-md\">\r\n+              <h3 className=\"text-lg font-semibold mb-3 text-center\">\r\n+                Plagiarism Summary\r\n+              </h3>\r\n+              <Doughnut\r\n+                data={generateChartData(analysisResult.document_visualizer)}\r\n+              />\r\n+              <div className=\"mt-4 text-center space-y-1\">\r\n+                <p>\r\n+                  <strong className=\"text-red-600\">Direct:</strong>{\" \"}\r\n+                  {\r\n+                    analysisResult.document_visualizer.filter(\r\n+                      (s) => s.type === \"Direct Match\"\r\n+                    ).length\r\n+                  }\r\n+                </p>\r\n+                <p>\r\n+                  <strong className=\"text-yellow-600\">Paraphrased:</strong>{\" \"}\r\n+                  {\r\n+                    analysisResult.document_visualizer.filter(\r\n+                      (s) => s.type === \"Paraphrased\"\r\n+                    ).length\r\n+                  }\r\n+                </p>\r\n+                <p>\r\n+                  <strong className=\"text-green-600\">Unique:</strong>{\" \"}\r\n+                  {\r\n+                    analysisResult.document_visualizer.filter(\r\n+                      (s) => !s.type\r\n+                    ).length\r\n+                  }\r\n+                </p>\r\n+              </div>\r\n+            </div>\r\n+          </div>\r\n+\r\n+          {/* Flagged Sentences List */}\r\n+          <h4 className=\"text-lg font-semibold mt-8 mb-2\">Flagged Sections:</h4>\r\n+          <div className=\"space-y-4\">\r\n+            {analysisResult.document_visualizer?.filter(\r\n+              (s) => s.type\r\n+            ).length > 0 ? (\r\n+              analysisResult.document_visualizer\r\n+                .filter((s) => s.type)\r\n+                .map((section, index) => (\r\n+                  <div\r\n+                    key={index}\r\n+                    className=\"border border-gray-200 p-4 rounded-md\"\r\n+                  >\r\n+                    <p className=\"text-gray-700 italic\">\"{section.text}\"</p>\r\n+                    <p className=\"text-sm mt-2\">\r\n+                      <strong>Source:</strong>{\" \"}\r\n+                      <span className=\"text-gray-600\">\r\n+                        {section.match?.source || \"Unknown\"}\r\n+                      </span>\r\n+                    </p>\r\n+                    <p className=\"text-sm\">\r\n+                      <strong>Similarity:</strong>{\" \"}\r\n+                      <span className=\"font-semibold text-indigo-600\">\r\n+                        {section.match?.similarity || \"N/A\"}% (\r\n+                        {section.type || \"N/A\"})\r\n+                      </span>\r\n+                    </p>\r\n+                    <div className=\"mt-3\">\r\n+                      <button\r\n+                        onClick={() => handleRewrite(section.text, index)}\r\n+                        disabled={rewritingIndex === index}\r\n+                        className=\"text-sm font-medium text-indigo-600 hover:text-indigo-800 disabled:opacity-50 disabled:cursor-wait\"\r\n+                      >\r\n+                        {rewritingIndex === index\r\n+                          ? \"Generating...\"\r\n+                          : \"âœ¨ Suggest Rewrite\"}\r\n+                      </button>\r\n+                      {rewriteSuggestions[index] && (\r\n+                        <div className=\"mt-2 p-3 bg-indigo-50 rounded-md\">\r\n+                          <p className=\"text-sm text-gray-800\">\r\n+                            {rewriteSuggestions[index]}\r\n+                          </p>\r\n+                        </div>\r\n+                      )}\r\n+                    </div>\r\n+                  </div>\r\n+                ))\r\n+            ) : (\r\n+              <p className=\"text-gray-500\">No plagiarized sections found.</p>\r\n+            )}\r\n+          </div>\r\n+        </div>\r\n+      )}\r\n+    </div>\r\n+  );\r\n+};\r\n+\r\n+export default Dashboard;\r\n+\r\n+\r\n import React, { useState, useRef } from 'react';\r\n import axios from 'axios';\r\n \r\n const Dashboard = () => {\r\n"
                },
                {
                    "date": 1762435531717,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,4 @@\n-// frontend/src/pages/Dashboard.js\r\n import React, { useState, useRef } from \"react\";\r\n import axios from \"axios\";\r\n import { Doughnut } from \"react-chartjs-2\";\r\n import \"chart.js/auto\";\r\n@@ -341,223 +340,4 @@\n   );\r\n };\r\n \r\n export default Dashboard;\r\n-\r\n-\r\n-import React, { useState, useRef } from 'react';\r\n-import axios from 'axios';\r\n-\r\n-const Dashboard = () => {\r\n-    const [file, setFile] = useState(null);\r\n-    const [analysisResult, setAnalysisResult] = useState(null);\r\n-    const [message, setMessage] = useState('');\r\n-    const [isLoading, setIsLoading] = useState(false);\r\n-    const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n-    const [rewritingIndex, setRewritingIndex] = useState(null);\r\n-    const fileInputRef = useRef(null);\r\n-\r\n-    // Retrieve JWT token from localStorage\r\n-    const getAuthToken = () => {\r\n-        try {\r\n-            const user = JSON.parse(localStorage.getItem('user'));\r\n-            return user?.token || null;\r\n-        } catch {\r\n-            return null;\r\n-        }\r\n-    };\r\n-\r\n-    const onFileChange = e => {\r\n-        setFile(e.target.files[0]);\r\n-    };\r\n-\r\n-    const onFormSubmit = async e => {\r\n-        e.preventDefault();\r\n-        setIsLoading(true);\r\n-        setMessage('Uploading and analyzing...');\r\n-        setAnalysisResult(null);\r\n-        setRewriteSuggestions({});\r\n-\r\n-        if (!file) {\r\n-            setMessage('Please select a file first.');\r\n-            setIsLoading(false);\r\n-            return;\r\n-        }\r\n-\r\n-        try {\r\n-            const token = getAuthToken();\r\n-            if (!token) {\r\n-                setMessage('Authorization error. Please log in again.');\r\n-                setIsLoading(false);\r\n-                return;\r\n-            }\r\n-\r\n-            const formData = new FormData();\r\n-            formData.append('document', file);\r\n-\r\n-            const config = {\r\n-                headers: {\r\n-                    'Content-Type': 'multipart/form-data',\r\n-                    'x-auth-token': token\r\n-                },\r\n-                timeout: 30000\r\n-            };\r\n-\r\n-            const response = await axios.post(\r\n-                'http://localhost:5000/api/documents/upload',\r\n-                formData,\r\n-                config\r\n-            );\r\n-\r\n-            setAnalysisResult(response.data);\r\n-            setMessage('Analysis Complete!');\r\n-        } catch (error) {\r\n-            console.error('File upload error:', error);\r\n-            setMessage('Analysis failed. Please re-login or retry.');\r\n-        } finally {\r\n-            setIsLoading(false);\r\n-        }\r\n-    };\r\n-\r\n-    const handleRewrite = async (sentence, index) => {\r\n-        setRewritingIndex(index);\r\n-        try {\r\n-            const token = getAuthToken();\r\n-            if (!token) {\r\n-                setRewriteSuggestions(prev => ({ ...prev, [index]: \"Authorization error.\" }));\r\n-                return;\r\n-            }\r\n-\r\n-            const config = {\r\n-                headers: {\r\n-                    'Content-Type': 'application/json',\r\n-                    'x-auth-token': token\r\n-                },\r\n-                timeout: 20000\r\n-            };\r\n-\r\n-            const response = await axios.post(\r\n-                'http://localhost:5000/api/documents/rewrite',\r\n-                { sentence },\r\n-                config\r\n-            );\r\n-\r\n-            setRewriteSuggestions(prev => ({\r\n-                ...prev,\r\n-                [index]: response.data.rewritten_text\r\n-            }));\r\n-        } catch (error) {\r\n-            console.error('Rewrite error:', error);\r\n-            setRewriteSuggestions(prev => ({\r\n-                ...prev,\r\n-                [index]: \"Error getting suggestion.\"\r\n-            }));\r\n-        } finally {\r\n-            setRewritingIndex(null);\r\n-        }\r\n-    };\r\n-\r\n-    const handleClear = () => {\r\n-        setFile(null);\r\n-        setAnalysisResult(null);\r\n-        setMessage('');\r\n-        setRewriteSuggestions({});\r\n-        if (fileInputRef.current) {\r\n-            fileInputRef.current.value = \"\";\r\n-        }\r\n-    };\r\n-\r\n-    return (\r\n-        <div className=\"container mx-auto mt-10 p-4\">\r\n-            <div className=\"w-full max-w-2xl mx-auto p-6 sm:p-8 space-y-6 bg-white rounded-lg shadow-md\">\r\n-                <h2 className=\"text-2xl font-bold text-center\">Dashboard</h2>\r\n-                <form onSubmit={onFormSubmit} className=\"space-y-4\">\r\n-                    <div>\r\n-                        <label htmlFor=\"file-upload\" className=\"block text-sm font-medium text-gray-700\">\r\n-                            Upload your document\r\n-                        </label>\r\n-                        <div className=\"mt-1 flex items-center\">\r\n-                            <input\r\n-                                type=\"file\"\r\n-                                ref={fileInputRef}\r\n-                                onChange={onFileChange}\r\n-                                disabled={isLoading}\r\n-                                className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 \r\n-                                           file:rounded-full file:border-0 file:text-sm file:font-semibold \r\n-                                           file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 \r\n-                                           disabled:opacity-50\"\r\n-                            />\r\n-                        </div>\r\n-                    </div>\r\n-                    <button\r\n-                        type=\"submit\"\r\n-                        disabled={isLoading}\r\n-                        className=\"w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md \r\n-                                   hover:bg-indigo-700 focus:outline-none focus:ring-2 \r\n-                                   focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 \r\n-                                   disabled:cursor-not-allowed\"\r\n-                    >\r\n-                        {isLoading ? 'Analyzing...' : 'Upload & Analyze'}\r\n-                    </button>\r\n-                </form>\r\n-\r\n-                {message && !isLoading && (\r\n-                    <p className=\"text-center text-sm text-gray-600 mt-4\">{message}</p>\r\n-                )}\r\n-            </div>\r\n-\r\n-            {analysisResult && (\r\n-                <div className=\"w-full max-w-2xl mx-auto mt-8 p-6 sm:p-8 bg-white rounded-lg shadow-md\">\r\n-                    <div className=\"flex justify-between items-center mb-4\">\r\n-                        <h3 className=\"text-xl font-bold\">Analysis Report</h3>\r\n-                        <button\r\n-                            onClick={handleClear}\r\n-                            className=\"px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200\"\r\n-                        >\r\n-                            Clear\r\n-                        </button>\r\n-                    </div>\r\n-                    <p className=\"text-lg mb-4\">\r\n-                        <strong>Overall Plagiarism Score:</strong> {analysisResult.overall_score}%\r\n-                    </p>\r\n-                    <h4 className=\"text-lg font-semibold mb-2\">Flagged Sections:</h4>\r\n-                    <div className=\"space-y-4\">\r\n-                        {analysisResult.flagged_sections.length > 0 ? (\r\n-                            analysisResult.flagged_sections.map((section, index) => (\r\n-                                <div key={index} className=\"border border-gray-200 p-4 rounded-md\">\r\n-                                    <p className=\"text-gray-700 italic\">\"{section.text}\"</p>\r\n-                                    <p className=\"text-sm mt-2\">\r\n-                                        <strong>Source:</strong> <span className=\"text-gray-600\">{section.source}</span>\r\n-                                    </p>\r\n-                                    <p className=\"text-sm\">\r\n-                                        <strong>Similarity:</strong>{' '}\r\n-                                        <span className=\"font-semibold text-indigo-600\">\r\n-                                            {section.similarity}% ({section.type})\r\n-                                        </span>\r\n-                                    </p>\r\n-                                    <div className=\"mt-3\">\r\n-                                        <button\r\n-                                            onClick={() => handleRewrite(section.text, index)}\r\n-                                            disabled={rewritingIndex === index}\r\n-                                            className=\"text-sm font-medium text-indigo-600 hover:text-indigo-800 disabled:opacity-50 disabled:cursor-wait\"\r\n-                                        >\r\n-                                            {rewritingIndex === index ? 'Generating...' : 'âœ¨ Suggest Rewrite'}\r\n-                                        </button>\r\n-                                        {rewriteSuggestions[index] && (\r\n-                                            <div className=\"mt-2 p-3 bg-indigo-50 rounded-md\">\r\n-                                                <p className=\"text-sm text-gray-800\">{rewriteSuggestions[index]}</p>\r\n-                                            </div>\r\n-                                        )}\r\n-                                    </div>\r\n-                                </div>\r\n-                            ))\r\n-                        ) : (\r\n-                            <p className=\"text-gray-500\">No plagiarized sections found.</p>\r\n-                        )}\r\n-                    </div>\r\n-                </div>\r\n-            )}\r\n-        </div>\r\n-    );\r\n-};\r\n-\r\n-export default Dashboard;\r\n"
                },
                {
                    "date": 1762436487596,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,8 @@\n   const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n   const [rewritingIndex, setRewritingIndex] = useState(null);\r\n   const fileInputRef = useRef(null);\r\n \r\n-  // Retrieve JWT token from localStorage\r\n   const getAuthToken = () => {\r\n     try {\r\n       const user = JSON.parse(localStorage.getItem(\"user\"));\r\n       return user?.token || null;\r\n@@ -124,9 +123,9 @@\n       fileInputRef.current.value = \"\";\r\n     }\r\n   };\r\n \r\n-  // Helper to highlight text\r\n+  // highlight helper\r\n   const highlightSentence = (section) => {\r\n     if (section.type === \"Direct Match\") {\r\n       return (\r\n         <span\r\n@@ -149,10 +148,11 @@\n       return <span key={section.text}>{section.text + \" \"}</span>;\r\n     }\r\n   };\r\n \r\n-  // Chart configuration\r\n-  const generateChartData = (sections) => {\r\n+  // ðŸ§© Safe chart generator\r\n+  const generateChartData = (sections = []) => {\r\n+    if (!Array.isArray(sections)) sections = [];\r\n     let direct = 0,\r\n       paraphrased = 0,\r\n       unique = 0;\r\n \r\n@@ -173,8 +173,13 @@\n       ],\r\n     };\r\n   };\r\n \r\n+  const visualizerData =\r\n+    analysisResult?.document_visualizer && Array.isArray(analysisResult.document_visualizer)\r\n+      ? analysisResult.document_visualizer\r\n+      : [];\r\n+\r\n   return (\r\n     <div className=\"container mx-auto mt-10 p-4\">\r\n       <div className=\"w-full max-w-2xl mx-auto p-6 sm:p-8 space-y-6 bg-white rounded-lg shadow-md\">\r\n         <h2 className=\"text-2xl font-bold text-center\">Dashboard</h2>\r\n@@ -228,69 +233,57 @@\n             </button>\r\n           </div>\r\n           <p className=\"text-lg mb-4\">\r\n             <strong>Overall Plagiarism Score:</strong>{\" \"}\r\n-            {analysisResult.overall_score}%\r\n+            {analysisResult.overall_score ?? \"N/A\"}%\r\n           </p>\r\n \r\n-          {/* Donut Chart + Highlighted Text */}\r\n+          {/* Layout */}\r\n           <div className=\"flex flex-col lg:flex-row gap-6\">\r\n-            {/* Left side: Highlighted Original Text */}\r\n+            {/* Highlighted Text */}\r\n             <div className=\"flex-1 bg-gray-50 p-4 rounded-md max-h-[70vh] overflow-y-auto shadow-sm\">\r\n               <h3 className=\"text-lg font-semibold mb-2\">Uploaded Document</h3>\r\n               <p className=\"text-gray-800 leading-7 text-justify\">\r\n-                {analysisResult.document_visualizer?.map((section, index) => (\r\n-                  <React.Fragment key={index}>\r\n-                    {highlightSentence(section)}\r\n-                  </React.Fragment>\r\n-                ))}\r\n+                {visualizerData.length > 0 ? (\r\n+                  visualizerData.map((section, index) => (\r\n+                    <React.Fragment key={index}>\r\n+                      {highlightSentence(section)}\r\n+                    </React.Fragment>\r\n+                  ))\r\n+                ) : (\r\n+                  <span>No text found for visualization.</span>\r\n+                )}\r\n               </p>\r\n             </div>\r\n \r\n-            {/* Right side: Donut Chart */}\r\n+            {/* Donut Chart */}\r\n             <div className=\"w-full lg:w-1/3 bg-white p-4 rounded-md shadow-md\">\r\n               <h3 className=\"text-lg font-semibold mb-3 text-center\">\r\n                 Plagiarism Summary\r\n               </h3>\r\n-              <Doughnut\r\n-                data={generateChartData(analysisResult.document_visualizer)}\r\n-              />\r\n+              <Doughnut data={generateChartData(visualizerData)} />\r\n               <div className=\"mt-4 text-center space-y-1\">\r\n                 <p>\r\n                   <strong className=\"text-red-600\">Direct:</strong>{\" \"}\r\n-                  {\r\n-                    analysisResult.document_visualizer.filter(\r\n-                      (s) => s.type === \"Direct Match\"\r\n-                    ).length\r\n-                  }\r\n+                  {visualizerData.filter((s) => s.type === \"Direct Match\").length}\r\n                 </p>\r\n                 <p>\r\n                   <strong className=\"text-yellow-600\">Paraphrased:</strong>{\" \"}\r\n-                  {\r\n-                    analysisResult.document_visualizer.filter(\r\n-                      (s) => s.type === \"Paraphrased\"\r\n-                    ).length\r\n-                  }\r\n+                  {visualizerData.filter((s) => s.type === \"Paraphrased\").length}\r\n                 </p>\r\n                 <p>\r\n                   <strong className=\"text-green-600\">Unique:</strong>{\" \"}\r\n-                  {\r\n-                    analysisResult.document_visualizer.filter(\r\n-                      (s) => !s.type\r\n-                    ).length\r\n-                  }\r\n+                  {visualizerData.filter((s) => !s.type).length}\r\n                 </p>\r\n               </div>\r\n             </div>\r\n           </div>\r\n \r\n-          {/* Flagged Sentences List */}\r\n+          {/* Flagged List */}\r\n           <h4 className=\"text-lg font-semibold mt-8 mb-2\">Flagged Sections:</h4>\r\n           <div className=\"space-y-4\">\r\n-            {analysisResult.document_visualizer?.filter(\r\n-              (s) => s.type\r\n-            ).length > 0 ? (\r\n-              analysisResult.document_visualizer\r\n+            {visualizerData.filter((s) => s.type).length > 0 ? (\r\n+              visualizerData\r\n                 .filter((s) => s.type)\r\n                 .map((section, index) => (\r\n                   <div\r\n                     key={index}\r\n"
                },
                {
                    "date": 1762440781656,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,13 @@\n import axios from \"axios\";\r\n import { Doughnut } from \"react-chartjs-2\";\r\n import \"chart.js/auto\";\r\n \r\n+// --- NEW IMPORTS ---\r\n+import { jsPDF } from \"jspdf\";\r\n+import \"jspdf-autotable\";\r\n+// --------------------\r\n+\r\n const Dashboard = () => {\r\n   const [file, setFile] = useState(null);\r\n   const [analysisResult, setAnalysisResult] = useState(null);\r\n   const [message, setMessage] = useState(\"\");\r\n@@ -123,8 +128,63 @@\n       fileInputRef.current.value = \"\";\r\n     }\r\n   };\r\n \r\n+  // ðŸ”½ --- ADD THIS NEW FUNCTION --- ðŸ”½\r\n+  const handleDownloadPDF = () => {\r\n+    if (!analysisResult) return;\r\n+\r\n+    const doc = new jsPDF();\r\n+    const visualizerData =\r\n+      analysisResult?.document_visualizer && Array.isArray(analysisResult.document_visualizer)\r\n+        ? analysisResult.document_visualizer\r\n+        : [];\r\n+    \r\n+    // --- 1. Add Title and Summary ---\r\n+    doc.setFontSize(20);\r\n+    doc.text(\"Plagiarism Analysis Report\", 14, 22);\r\n+    doc.setFontSize(12);\r\n+    doc.text(`Overall Plagiarism Score: ${analysisResult.overall_score ?? \"N/A\"}%`, 14, 32);\r\n+\r\n+    const direct = visualizerData.filter((s) => s.type === \"Direct Match\").length;\r\n+    const paraphrased = visualizerData.filter((s) => s.type === \"Paraphrased\").length;\r\n+    const unique = visualizerData.filter((s) => !s.type).length;\r\n+\r\n+    doc.text(`Direct Matches: ${direct}`, 14, 40);\r\n+    doc.text(`Paraphrased Sections: ${paraphrased}`, 14, 48);\r\n+    doc.text(`Unique Sections: ${unique}`, 14, 56);\r\n+\r\n+    // --- 2. Add Table of Flagged Sections ---\r\n+    const tableData = visualLizerData\r\n+      .filter((s) => s.type) // Only get flagged sections\r\n+      .map((section, index) => {\r\n+        return [\r\n+          index + 1,\r\n+          section.text.substring(0, 60) + \"...\", // Truncate text\r\n+          section.type,\r\n+          `${section.match?.similarity || \"N/A\"}%`,\r\n+          section.match?.source || \"Unknown\",\r\n+        ];\r\n+      });\r\n+\r\n+    if (tableData.length > 0) {\r\n+      doc.autoTable({\r\n+        startY: 65,\r\n+        head: [['#', 'Flagged Text', 'Type', 'Similarity', 'Source']],\r\n+        body: tableData,\r\n+        theme: 'grid',\r\n+        headStyles: { fillColor: [74, 85, 104] }, // A dark header\r\n+      });\r\n+    } else {\r\n+      doc.text(\"No plagiarized sections found.\", 14, 65);\r\n+    }\r\n+    \r\n+    // --- 3. Save the PDF ---\r\n+    doc.save(\"plagiarism-report.pdf\");\r\n+  };\r\n+  // ðŸ”¼ --- END OF NEW FUNCTION --- ðŸ”¼\r\n+\r\n+\r\n   // highlight helper\r\n   const highlightSentence = (section) => {\r\n     if (section.type === \"Direct Match\") {\r\n       return (\r\n@@ -222,17 +282,29 @@\n       </div>\r\n \r\n       {analysisResult && (\r\n         <div className=\"w-full max-w-6xl mx-auto mt-8 p-6 sm:p-8 bg-white rounded-lg shadow-md\">\r\n+          \r\n+          {/* ðŸ”½ --- UPDATE THIS SECTION --- ðŸ”½ */}\r\n           <div className=\"flex justify-between items-center mb-4\">\r\n             <h3 className=\"text-xl font-bold\">Analysis Report</h3>\r\n-            <button\r\n-              onClick={handleClear}\r\n-              className=\"px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200\"\r\n-            >\r\n-              Clear\r\n-            </button>\r\n+            <div className=\"flex gap-2\">\r\n+              <button\r\n+                onClick={handleDownloadPDF}\r\n+                className=\"px-3 py-1 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700\"\r\n+              >\r\n+                Download Report (PDF)\r\n+              </button>\r\n+              <button\r\n+                onClick={handleClear}\r\n+                className=\"px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200\"\r\n+              >\r\n+                Clear\r\n+              </button>\r\n+            </div>\r\n           </div>\r\n+          {/* ðŸ”¼ --- END OF UPDATE --- ðŸ”¼ */}\r\n+\r\n           <p className=\"text-lg mb-4\">\r\n             <strong>Overall Plagiarism Score:</strong>{\" \"}\r\n             {analysisResult.overall_score ?? \"N/A\"}%\r\n           </p>\r\n@@ -264,9 +336,9 @@\n               <div className=\"mt-4 text-center space-y-1\">\r\n                 <p>\r\n                   <strong className=\"text-red-600\">Direct:</strong>{\" \"}\r\n                   {visualizerData.filter((s) => s.type === \"Direct Match\").length}\r\n-                </p>\r\n+                </ndiv>\r\n                 <p>\r\n                   <strong className=\"text-yellow-600\">Paraphrased:</strong>{\" \"}\r\n                   {visualizerData.filter((s) => s.type === \"Paraphrased\").length}\r\n                 </p>\r\n@@ -332,5 +404,5 @@\n     </div>\r\n   );\r\n };\r\n \r\n-export default Dashboard;\r\n+export default Dashboard;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1762445890547,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,11 +2,13 @@\n import axios from \"axios\";\r\n import { Doughnut } from \"react-chartjs-2\";\r\n import \"chart.js/auto\";\r\n \r\n-// --- NEW IMPORTS ---\r\n-import { jsPDF } from \"jspdf\";\r\n-import \"jspdf-autotable\";\r\n+// --- REMOVED IMPORTS ---\r\n+// We will access jspdf from the global 'window' object\r\n+// in case the preview environment loads it from a CDN.\r\n+// import { jsPDF } from \"jspdf\";\r\n+// import \"jspdf-autotable\";\r\n // --------------------\r\n \r\n const Dashboard = () => {\r\n   const [file, setFile] = useState(null);\r\n@@ -128,13 +130,22 @@\n       fileInputRef.current.value = \"\";\r\n     }\r\n   };\r\n \r\n-  // ðŸ”½ --- ADD THIS NEW FUNCTION --- ðŸ”½\r\n   const handleDownloadPDF = () => {\r\n     if (!analysisResult) return;\r\n \r\n+    // --- GRAB jspdf from window object ---\r\n+    // This allows the code to work in the preview environment\r\n+    if (!window.jspdf || !window.jspdf.jsPDF) {\r\n+      console.error(\"jsPDF library is not loaded. Cannot generate PDF.\");\r\n+      setMessage(\"Error: PDF generation library not found.\");\r\n+      return;\r\n+    }\r\n+    const { jsPDF } = window.jspdf;\r\n     const doc = new jsPDF();\r\n+    // ------------------------------------\r\n+\r\n     const visualizerData =\r\n       analysisResult?.document_visualizer && Array.isArray(analysisResult.document_visualizer)\r\n         ? analysisResult.document_visualizer\r\n         : [];\r\n@@ -153,9 +164,9 @@\n     doc.text(`Paraphrased Sections: ${paraphrased}`, 14, 48);\r\n     doc.text(`Unique Sections: ${unique}`, 14, 56);\r\n \r\n     // --- 2. Add Table of Flagged Sections ---\r\n-    const tableData = visualLizerData\r\n+    const tableData = visualizerData\r\n       .filter((s) => s.type) // Only get flagged sections\r\n       .map((section, index) => {\r\n         return [\r\n           index + 1,\r\n@@ -166,8 +177,14 @@\n         ];\r\n       });\r\n \r\n     if (tableData.length > 0) {\r\n+      // Check if autoTable plugin is loaded\r\n+      if (typeof doc.autoTable !== 'function') {\r\n+        console.error(\"jsPDF-autoTable plugin is not loaded.\");\r\n+        setMessage(\"Error: PDF table generation library not found.\");\r\n+        return;\r\n+      }\r\n       doc.autoTable({\r\n         startY: 65,\r\n         head: [['#', 'Flagged Text', 'Type', 'Similarity', 'Source']],\r\n         body: tableData,\r\n@@ -180,9 +197,8 @@\n     \r\n     // --- 3. Save the PDF ---\r\n     doc.save(\"plagiarism-report.pdf\");\r\n   };\r\n-  // ðŸ”¼ --- END OF NEW FUNCTION --- ðŸ”¼\r\n \r\n \r\n   // highlight helper\r\n   const highlightSentence = (section) => {\r\n@@ -240,52 +256,14 @@\n       : [];\r\n \r\n   return (\r\n     <div className=\"container mx-auto mt-10 p-4\">\r\n-      <div className=\"w-full max-w-2xl mx-auto p-6 sm:p-8 space-y-6 bg-white rounded-lg shadow-md\">\r\n-        <h2 className=\"text-2xl font-bold text-center\">Dashboard</h2>\r\n-        <form onSubmit={onFormSubmit} className=\"space-y-4\">\r\n-          <div>\r\n-            <label\r\n-              htmlFor=\"file-upload\"\r\n-              className=\"block text-sm font-medium text-gray-700\"\r\n-            >\r\n-              Upload your document\r\n-            </label>\r\n-            <div className=\"mt-1 flex items-center\">\r\n-              <input\r\n-                type=\"file\"\r\n-                ref={fileInputRef}\r\n-                onChange={onFileChange}\r\n-                disabled={isLoading}\r\n-                className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 \r\n-                             file:rounded-full file:border-0 file:text-sm file:font-semibold \r\n-                             file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 \r\n-                             disabled:opacity-50\"\r\n-              />\r\n-            </div>\r\n-          </div>\r\n-          <button\r\n-            type=\"submit\"\r\n-            disabled={isLoading}\r\n-            className=\"w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md \r\n-                       hover:bg-indigo-700 focus:outline-none focus:ring-2 \r\n-                       focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 \r\n-                       disabled:cursor-not-allowed\"\r\n-          >\r\n-            {isLoading ? \"Analyzing...\" : \"Upload & Analyze\"}\r\n-          </button>\r\n-        </form>\r\n-\r\n-        {message && !isLoading && (\r\n-          <p className=\"text-center text-sm text-gray-600 mt-4\">{message}</p>\r\n-        )}\r\n-      </div>\r\n-\r\n+      {/* ... existing code ... */}\r\n+      \r\n       {analysisResult && (\r\n         <div className=\"w-full max-w-6xl mx-auto mt-8 p-6 sm:p-8 bg-white rounded-lg shadow-md\">\r\n           \r\n-          {/* ðŸ”½ --- UPDATE THIS SECTION --- ðŸ”½ */}\r\n+          {/* ... existing code ... */}\r\n           <div className=\"flex justify-between items-center mb-4\">\r\n             <h3 className=\"text-xl font-bold\">Analysis Report</h3>\r\n             <div className=\"flex gap-2\">\r\n               <button\r\n@@ -301,20 +279,18 @@\n                 Clear\r\n               </button>\r\n             </div>\r\n           </div>\r\n-          {/* ðŸ”¼ --- END OF UPDATE --- ðŸ”¼ */}\r\n \r\n           <p className=\"text-lg mb-4\">\r\n-            <strong>Overall Plagiarism Score:</strong>{\" \"}\r\n-            {analysisResult.overall_score ?? \"N/A\"}%\r\n+            {/* ... existing code ... */}\r\n           </p>\r\n \r\n           {/* Layout */}\r\n           <div className=\"flex flex-col lg:flex-row gap-6\">\r\n             {/* Highlighted Text */}\r\n             <div className=\"flex-1 bg-gray-50 p-4 rounded-md max-h-[70vh] overflow-y-auto shadow-sm\">\r\n-              <h3 className=\"text-lg font-semibold mb-2\">Uploaded Document</h3>\r\n+              {/* ... existing code ... */}\r\n               <p className=\"text-gray-800 leading-7 text-justify\">\r\n                 {visualizerData.length > 0 ? (\r\n                   visualizerData.map((section, index) => (\r\n                     <React.Fragment key={index}>\r\n@@ -328,17 +304,15 @@\n             </div>\r\n \r\n             {/* Donut Chart */}\r\n             <div className=\"w-full lg:w-1/3 bg-white p-4 rounded-md shadow-md\">\r\n-              <h3 className=\"text-lg font-semibold mb-3 text-center\">\r\n-                Plagiarism Summary\r\n-              </h3>\r\n+              {/* ... existing code ... */}\r\n               <Doughnut data={generateChartData(visualizerData)} />\r\n               <div className=\"mt-4 text-center space-y-1\">\r\n                 <p>\r\n                   <strong className=\"text-red-600\">Direct:</strong>{\" \"}\r\n                   {visualizerData.filter((s) => s.type === \"Direct Match\").length}\r\n-                </ndiv>\r\n+                </p> \r\n                 <p>\r\n                   <strong className=\"text-yellow-600\">Paraphrased:</strong>{\" \"}\r\n                   {visualizerData.filter((s) => s.type === \"Paraphrased\").length}\r\n                 </p>\r\n@@ -360,22 +334,9 @@\n                   <div\r\n                     key={index}\r\n                     className=\"border border-gray-200 p-4 rounded-md\"\r\n                   >\r\n-                    <p className=\"text-gray-700 italic\">\"{section.text}\"</p>\r\n-                    <p className=\"text-sm mt-2\">\r\n-                      <strong>Source:</strong>{\" \"}\r\n-                      <span className=\"text-gray-600\">\r\n-                        {section.match?.source || \"Unknown\"}\r\n-                      </span>\r\n-                    </p>\r\n-                    <p className=\"text-sm\">\r\n-                      <strong>Similarity:</strong>{\" \"}\r\n-                      <span className=\"font-semibold text-indigo-600\">\r\n-                        {section.match?.similarity || \"N/A\"}% (\r\n-                        {section.type || \"N/A\"})\r\n-                      </span>\r\n-                    </p>\r\n+                    {/* ... existing code ... */}\r\n                     <div className=\"mt-3\">\r\n                       <button\r\n                         onClick={() => handleRewrite(section.text, index)}\r\n                         disabled={rewritingIndex === index}\r\n"
                },
                {
                    "date": 1762446668856,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,369 +1,87 @@\n-import React, { useState, useRef } from \"react\";\r\n-import axios from \"axios\";\r\n-import { Doughnut } from \"react-chartjs-2\";\r\n-import \"chart.js/auto\";\r\n+import React, { useState, useEffect } from 'react';\r\n+import { useLocation } from 'react-router-dom';\r\n \r\n-// --- REMOVED IMPORTS ---\r\n-// We will access jspdf from the global 'window' object\r\n-// in case the preview environment loads it from a CDN.\r\n-// import { jsPDF } from \"jspdf\";\r\n-// import \"jspdf-autotable\";\r\n-// --------------------\r\n+// 1. Import all your new components\r\n+import ReportVisualizer from '../components/Report/ReportVisualizer';\r\n+import ScoreDonut from '../components/Chart/ScoreDonut';\r\n+import RewriteModal from '../components/Actions/RewriteModal';\r\n+import DownloadButton from '../components/Actions/DownloadButton';\r\n \r\n-const Dashboard = () => {\r\n-  const [file, setFile] = useState(null);\r\n-  const [analysisResult, setAnalysisResult] = useState(null);\r\n-  const [message, setMessage] = useState(\"\");\r\n-  const [isLoading, setIsLoading] = useState(false);\r\n-  const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n-  const [rewritingIndex, setRewritingIndex] = useState(null);\r\n-  const fileInputRef = useRef(null);\r\n+// (You'll need a CSS file for the dashboard layout)\r\n+// import './Dashboard.css'; \r\n \r\n-  const getAuthToken = () => {\r\n-    try {\r\n-      const user = JSON.parse(localStorage.getItem(\"user\"));\r\n-      return user?.token || null;\r\n-    } catch {\r\n-      return null;\r\n-    }\r\n-  };\r\n+function Dashboard() {\r\n+  // --- STATE ---\r\n+  // The main report data lives here, in the parent\r\n+  const [reportData, setReportData] = useState(null);\r\n+  const [isLoading, setIsLoading] = useState(true);\r\n+  \r\n+  // State for controlling the rewrite modal\r\n+  const [isModalOpen, setIsModalOpen] = useState(false);\r\n+  const [sentenceToRewrite, setSentenceToRewrite] = useState('');\r\n \r\n-  const onFileChange = (e) => {\r\n-    setFile(e.target.files[0]);\r\n-  };\r\n-\r\n-  const onFormSubmit = async (e) => {\r\n-    e.preventDefault();\r\n-    setIsLoading(true);\r\n-    setMessage(\"Uploading and analyzing...\");\r\n-    setAnalysisResult(null);\r\n-    setRewriteSuggestions({});\r\n-\r\n-    if (!file) {\r\n-      setMessage(\"Please select a file first.\");\r\n+  // Get the report data passed from the upload page\r\n+  const location = useLocation();\r\n+  useEffect(() => {\r\n+    if (location.state && location.state.report) {\r\n+      setReportData(location.state.report);\r\n       setIsLoading(false);\r\n-      return;\r\n-    }\r\n-\r\n-    try {\r\n-      const token = getAuthToken();\r\n-      if (!token) {\r\n-        setMessage(\"Authorization error. Please log in again.\");\r\n-        setIsLoading(false);\r\n-        return;\r\n-      }\r\n-\r\n-      const formData = new FormData();\r\n-      formData.append(\"document\", file);\r\n-\r\n-      const config = {\r\n-        headers: {\r\n-          \"Content-Type\": \"multipart/form-data\",\r\n-          \"x-auth-token\": token,\r\n-        },\r\n-        timeout: 30000,\r\n-      };\r\n-\r\n-      const response = await axios.post(\r\n-        \"http://localhost:5000/api/documents/upload\",\r\n-        formData,\r\n-        config\r\n-      );\r\n-\r\n-      setAnalysisResult(response.data);\r\n-      setMessage(\"Analysis Complete!\");\r\n-    } catch (error) {\r\n-      console.error(\"File upload error:\", error);\r\n-      setMessage(\"Analysis failed. Please re-login or retry.\");\r\n-    } finally {\r\n+    } else {\r\n+      // Handle case where user lands here with no data\r\n+      console.error(\"No report data found!\");\r\n       setIsLoading(false);\r\n     }\r\n-  };\r\n+  }, [location]);\r\n \r\n-  const handleRewrite = async (sentence, index) => {\r\n-    setRewritingIndex(index);\r\n-    try {\r\n-      const token = getAuthToken();\r\n-      if (!token) {\r\n-        setRewriteSuggestions((prev) => ({\r\n-          ...prev,\r\n-          [index]: \"Authorization error.\",\r\n-        }));\r\n-        return;\r\n-      }\r\n-\r\n-      const config = {\r\n-        headers: {\r\n-          \"Content-Type\": \"application/json\",\r\n-          \"x-auth-token\": token,\r\n-        },\r\n-        timeout: 20000,\r\n-      };\r\n-\r\n-      const response = await axios.post(\r\n-        \"http://localhost:5000/api/documents/rewrite\",\r\n-        { sentence },\r\n-        config\r\n-      );\r\n-\r\n-      setRewriteSuggestions((prev) => ({\r\n-        ...prev,\r\n-        [index]: response.data.rewritten_text,\r\n-      }));\r\n-    } catch (error) {\r\n-      console.error(\"Rewrite error:\", error);\r\n-      setRewriteSuggestions((prev) => ({\r\n-        ...prev,\r\n-        [index]: \"Error getting suggestion.\",\r\n-      }));\r\n-    } finally {\r\n-      setRewritingIndex(null);\r\n-    }\r\n+  // --- \"Event Up\" Handler ---\r\n+  // This function is PASSED DOWN to ReportVisualizer\r\n+  // When the button is clicked there, it \"calls up\" to here\r\n+  const handleRewriteClick = (sentence) => {\r\n+    setSentenceToRewrite(sentence);\r\n+    setIsModalOpen(true);\r\n   };\r\n \r\n-  const handleClear = () => {\r\n-    setFile(null);\r\n-    setAnalysisResult(null);\r\n-    setMessage(\"\");\r\n-    setRewriteSuggestions({});\r\n-    if (fileInputRef.current) {\r\n-      fileInputRef.current.value = \"\";\r\n-    }\r\n-  };\r\n+  if (isLoading) {\r\n+    return <div>Loading report...</div>;\r\n+  }\r\n \r\n-  const handleDownloadPDF = () => {\r\n-    if (!analysisResult) return;\r\n+  if (!reportData) {\r\n+    return <div>Error: Could not load report.</div>;\r\n+  }\r\n \r\n-    // --- GRAB jspdf from window object ---\r\n-    // This allows the code to work in the preview environment\r\n-    if (!window.jspdf || !window.jspdf.jsPDF) {\r\n-      console.error(\"jsPDF library is not loaded. Cannot generate PDF.\");\r\n-      setMessage(\"Error: PDF generation library not found.\");\r\n-      return;\r\n-    }\r\n-    const { jsPDF } = window.jspdf;\r\n-    const doc = new jsPDF();\r\n-    // ------------------------------------\r\n-\r\n-    const visualizerData =\r\n-      analysisResult?.document_visualizer && Array.isArray(analysisResult.document_visualizer)\r\n-        ? analysisResult.document_visualizer\r\n-        : [];\r\n-    \r\n-    // --- 1. Add Title and Summary ---\r\n-    doc.setFontSize(20);\r\n-    doc.text(\"Plagiarism Analysis Report\", 14, 22);\r\n-    doc.setFontSize(12);\r\n-    doc.text(`Overall Plagiarism Score: ${analysisResult.overall_score ?? \"N/A\"}%`, 14, 32);\r\n-\r\n-    const direct = visualizerData.filter((s) => s.type === \"Direct Match\").length;\r\n-    const paraphrased = visualizerData.filter((s) => s.type === \"Paraphrased\").length;\r\n-    const unique = visualizerData.filter((s) => !s.type).length;\r\n-\r\n-    doc.text(`Direct Matches: ${direct}`, 14, 40);\r\n-    doc.text(`Paraphrased Sections: ${paraphrased}`, 14, 48);\r\n-    doc.text(`Unique Sections: ${unique}`, 14, 56);\r\n-\r\n-    // --- 2. Add Table of Flagged Sections ---\r\n-    const tableData = visualizerData\r\n-      .filter((s) => s.type) // Only get flagged sections\r\n-      .map((section, index) => {\r\n-        return [\r\n-          index + 1,\r\n-          section.text.substring(0, 60) + \"...\", // Truncate text\r\n-          section.type,\r\n-          `${section.match?.similarity || \"N/A\"}%`,\r\n-          section.match?.source || \"Unknown\",\r\n-        ];\r\n-      });\r\n-\r\n-    if (tableData.length > 0) {\r\n-      // Check if autoTable plugin is loaded\r\n-      if (typeof doc.autoTable !== 'function') {\r\n-        console.error(\"jsPDF-autoTable plugin is not loaded.\");\r\n-        setMessage(\"Error: PDF table generation library not found.\");\r\n-        return;\r\n-      }\r\n-      doc.autoTable({\r\n-        startY: 65,\r\n-        head: [['#', 'Flagged Text', 'Type', 'Similarity', 'Source']],\r\n-        body: tableData,\r\n-        theme: 'grid',\r\n-        headStyles: { fillColor: [74, 85, 104] }, // A dark header\r\n-      });\r\n-    } else {\r\n-      doc.text(\"No plagiarized sections found.\", 14, 65);\r\n-    }\r\n-    \r\n-    // --- 3. Save the PDF ---\r\n-    doc.save(\"plagiarism-report.pdf\");\r\n-  };\r\n-\r\n-\r\n-  // highlight helper\r\n-  const highlightSentence = (section) => {\r\n-    if (section.type === \"Direct Match\") {\r\n-      return (\r\n-        <span\r\n-          key={section.text}\r\n-          style={{ backgroundColor: \"#ff4d4d33\", color: \"#b30000\" }}\r\n-        >\r\n-          {section.text + \" \"}\r\n-        </span>\r\n-      );\r\n-    } else if (section.type === \"Paraphrased\") {\r\n-      return (\r\n-        <span\r\n-          key={section.text}\r\n-          style={{ backgroundColor: \"#fff2cc\", color: \"#b38f00\" }}\r\n-        >\r\n-          {section.text + \" \"}\r\n-        </span>\r\n-      );\r\n-    } else {\r\n-      return <span key={section.text}>{section.text + \" \"}</span>;\r\n-    }\r\n-  };\r\n-\r\n-  // ðŸ§© Safe chart generator\r\n-  const generateChartData = (sections = []) => {\r\n-    if (!Array.isArray(sections)) sections = [];\r\n-    let direct = 0,\r\n-      paraphrased = 0,\r\n-      unique = 0;\r\n-\r\n-    sections.forEach((s) => {\r\n-      if (s.type === \"Direct Match\") direct++;\r\n-      else if (s.type === \"Paraphrased\") paraphrased++;\r\n-      else unique++;\r\n-    });\r\n-\r\n-    return {\r\n-      labels: [\"Direct\", \"Paraphrased\", \"Unique\"],\r\n-      datasets: [\r\n-        {\r\n-          data: [direct, paraphrased, unique],\r\n-          backgroundColor: [\"#ff4d4d\", \"#ffcc00\", \"#4caf50\"],\r\n-          borderWidth: 1,\r\n-        },\r\n-      ],\r\n-    };\r\n-  };\r\n-\r\n-  const visualizerData =\r\n-    analysisResult?.document_visualizer && Array.isArray(analysisResult.document_visualizer)\r\n-      ? analysisResult.document_visualizer\r\n-      : [];\r\n-\r\n+  // --- RENDER ---\r\n+  // Notice how clean this is. It just assembles the pieces.\r\n   return (\r\n-    <div className=\"container mx-auto mt-10 p-4\">\r\n-      {/* ... existing code ... */}\r\n+    <div className=\"dashboard-container\">\r\n+      <h1>Plagiarism Report</h1>\r\n       \r\n-      {analysisResult && (\r\n-        <div className=\"w-full max-w-6xl mx-auto mt-8 p-6 sm:p-8 bg-white rounded-lg shadow-md\">\r\n-          \r\n-          {/* ... existing code ... */}\r\n-          <div className=\"flex justify-between items-center mb-4\">\r\n-            <h3 className=\"text-xl font-bold\">Analysis Report</h3>\r\n-            <div className=\"flex gap-2\">\r\n-              <button\r\n-                onClick={handleDownloadPDF}\r\n-                className=\"px-3 py-1 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700\"\r\n-              >\r\n-                Download Report (PDF)\r\n-              </button>\r\n-              <button\r\n-                onClick={handleClear}\r\n-                className=\"px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200\"\r\n-              >\r\n-                Clear\r\n-              </button>\r\n-            </div>\r\n-          </div>\r\n+      <div className=\"summary-section\">\r\n+        {/* Component #4: Donut Chart */}\r\n+        {/* \"Data Down\": Pass the score as a prop */}\r\n+        <ScoreDonut score={reportData.overall_score} />\r\n \r\n-          <p className=\"text-lg mb-4\">\r\n-            {/* ... existing code ... */}\r\n-          </p>\r\n+        {/* Component #2: Download Button */}\r\n+        <DownloadButton reportData={reportData} />\r\n+      </div>\r\n+      \r\n+      <hr />\r\n \r\n-          {/* Layout */}\r\n-          <div className=\"flex flex-col lg:flex-row gap-6\">\r\n-            {/* Highlighted Text */}\r\n-            <div className=\"flex-1 bg-gray-50 p-4 rounded-md max-h-[70vh] overflow-y-auto shadow-sm\">\r\n-              {/* ... existing code ... */}\r\n-              <p className=\"text-gray-800 leading-7 text-justify\">\r\n-                {visualizerData.length > 0 ? (\r\n-                  visualizerData.map((section, index) => (\r\n-                    <React.Fragment key={index}>\r\n-                      {highlightSentence(section)}\r\n-                    </React.Fragment>\r\n-                  ))\r\n-                ) : (\r\n-                  <span>No text found for visualization.</span>\r\n-                )}\r\n-              </p>\r\n-            </div>\r\n+      {/* Component #3: Detailed Report */}\r\n+      {/* \"Data Down\": Pass the sentences */}\r\n+      {/* \"Event Up\": Pass the handler function */}\r\n+      <ReportVisualizer \r\n+        sentences={reportData.document_visualizer}\r\n+        onRewriteClick={handleRewriteClick} \r\n+      />\r\n \r\n-            {/* Donut Chart */}\r\n-            <div className=\"w-full lg:w-1/3 bg-white p-4 rounded-md shadow-md\">\r\n-              {/* ... existing code ... */}\r\n-              <Doughnut data={generateChartData(visualizerData)} />\r\n-              <div className=\"mt-4 text-center space-y-1\">\r\n-                <p>\r\n-                  <strong className=\"text-red-600\">Direct:</strong>{\" \"}\r\n-                  {visualizerData.filter((s) => s.type === \"Direct Match\").length}\r\n-                </p> \r\n-                <p>\r\n-                  <strong className=\"text-yellow-600\">Paraphrased:</strong>{\" \"}\r\n-                  {visualizerData.filter((s) => s.type === \"Paraphrased\").length}\r\n-                </p>\r\n-                <p>\r\n-                  <strong className=\"text-green-600\">Unique:</strong>{\" \"}\r\n-                  {visualizerData.filter((s) => !s.type).length}\r\n-                </p>\r\n-              </div>\r\n-            </div>\r\n-          </div>\r\n-\r\n-          {/* Flagged List */}\r\n-          <h4 className=\"text-lg font-semibold mt-8 mb-2\">Flagged Sections:</h4>\r\n-          <div className=\"space-y-4\">\r\n-            {visualizerData.filter((s) => s.type).length > 0 ? (\r\n-              visualizerData\r\n-                .filter((s) => s.type)\r\n-                .map((section, index) => (\r\n-                  <div\r\n-                    key={index}\r\n-                    className=\"border border-gray-200 p-4 rounded-md\"\r\n-                  >\r\n-                    {/* ... existing code ... */}\r\n-                    <div className=\"mt-3\">\r\n-                      <button\r\n-                        onClick={() => handleRewrite(section.text, index)}\r\n-                        disabled={rewritingIndex === index}\r\n-                        className=\"text-sm font-medium text-indigo-600 hover:text-indigo-800 disabled:opacity-50 disabled:cursor-wait\"\r\n-                      >\r\n-                        {rewritingIndex === index\r\n-                          ? \"Generating...\"\r\n-                          : \"âœ¨ Suggest Rewrite\"}\r\n-                      </button>\r\n-                      {rewriteSuggestions[index] && (\r\n-                        <div className=\"mt-2 p-3 bg-indigo-50 rounded-md\">\r\n-                          <p className=\"text-sm text-gray-800\">\r\n-                            {rewriteSuggestions[index]}\r\n-                          </p>\r\n-                        </div>\r\n-                      )}\r\n-                    </div>\r\n-                  </div>\r\n-                ))\r\n-            ) : (\r\n-              <p className=\"text-gray-500\">No plagiarized sections found.</p>\r\n-            )}\r\n-          </div>\r\n-        </div>\r\n-      )}\r\n+      {/* Component #1: Rewrite Modal (hidden by default) */}\r\n+      <RewriteModal \r\n+        isOpen={isModalOpen}\r\n+        onClose={() => setIsModalOpen(false)}\r\n+        sentence={sentenceToRewrite}\r\n+      />\r\n     </div>\r\n   );\r\n-};\r\n+}\r\n \r\n export default Dashboard;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1762449545698,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,42 +1,51 @@\n import React, { useState, useEffect } from 'react';\r\n-import { useLocation } from 'react-router-dom';\r\n+import { useLocation, Link } from 'react-router-dom';\r\n \r\n // 1. Import all your new components\r\n import ReportVisualizer from '../components/Report/ReportVisualizer';\r\n import ScoreDonut from '../components/Chart/ScoreDonut';\r\n import RewriteModal from '../components/Actions/RewriteModal';\r\n import DownloadButton from '../components/Actions/DownloadButton';\r\n \r\n-// (You'll need a CSS file for the dashboard layout)\r\n-// import './Dashboard.css'; \r\n+// Basic styles for the dashboard layout\r\n+const dashboardStyles = {\r\n+  padding: '2rem',\r\n+  fontFamily: 'Arial, sans-serif',\r\n+  maxWidth: '1200px',\r\n+  margin: '0 auto'\r\n+};\r\n \r\n+const summaryStyles = {\r\n+  display: 'flex',\r\n+  justifyContent: 'space-around',\r\n+  alignItems: 'center',\r\n+  flexWrap: 'wrap',\r\n+  gap: '2rem',\r\n+  marginBottom: '2rem'\r\n+};\r\n+\r\n function Dashboard() {\r\n   // --- STATE ---\r\n-  // The main report data lives here, in the parent\r\n   const [reportData, setReportData] = useState(null);\r\n   const [isLoading, setIsLoading] = useState(true);\r\n   \r\n-  // State for controlling the rewrite modal\r\n   const [isModalOpen, setIsModalOpen] = useState(false);\r\n   const [sentenceToRewrite, setSentenceToRewrite] = useState('');\r\n \r\n-  // Get the report data passed from the upload page\r\n   const location = useLocation();\r\n+\r\n   useEffect(() => {\r\n     if (location.state && location.state.report) {\r\n       setReportData(location.state.report);\r\n       setIsLoading(false);\r\n     } else {\r\n-      // Handle case where user lands here with no data\r\n       console.error(\"No report data found!\");\r\n       setIsLoading(false);\r\n     }\r\n   }, [location]);\r\n \r\n-  // --- \"Event Up\" Handler ---\r\n-  // This function is PASSED DOWN to ReportVisualizer\r\n-  // When the button is clicked there, it \"calls up\" to here\r\n+  // This function is passed down to ReportVisualizer\r\n   const handleRewriteClick = (sentence) => {\r\n     setSentenceToRewrite(sentence);\r\n     setIsModalOpen(true);\r\n   };\r\n@@ -45,36 +54,43 @@\n     return <div>Loading report...</div>;\r\n   }\r\n \r\n   if (!reportData) {\r\n-    return <div>Error: Could not load report.</div>;\r\n+    return (\r\n+      <div style={dashboardStyles}>\r\n+        <h1>Error</h1>\r\n+        <p>Could not load report data. Please try analyzing again.</p>\r\n+        <Link to=\"/\">Go back to Home</Link>\r\n+      </div>\r\n+    );\r\n   }\r\n \r\n   // --- RENDER ---\r\n-  // Notice how clean this is. It just assembles the pieces.\r\n   return (\r\n-    <div className=\"dashboard-container\">\r\n-      <h1>Plagiarism Report</h1>\r\n+    <div style={dashboardStyles}>\r\n       \r\n-      <div className=\"summary-section\">\r\n-        {/* Component #4: Donut Chart */}\r\n-        {/* \"Data Down\": Pass the score as a prop */}\r\n-        <ScoreDonut score={reportData.overall_score} />\r\n+      {/* This is the wrapper for the PDF download */}\r\n+      <div id=\"report-to-download\">\r\n+        <h1 style={{ textAlign: 'center' }}>Plagiarism Report</h1>\r\n+        \r\n+        <div style={summaryStyles}>\r\n+          {/* Component #4: Donut Chart */}\r\n+          <ScoreDonut score={reportData.overall_score} />\r\n \r\n-        {/* Component #2: Download Button */}\r\n-        <DownloadButton reportData={reportData} />\r\n-      </div>\r\n-      \r\n-      <hr />\r\n+          {/* Component #2: Download Button */}\r\n+          <DownloadButton targetId=\"report-to-download\" />\r\n+        </div>\r\n+        \r\n+        <hr style={{ margin: '2rem 0' }} />\r\n \r\n-      {/* Component #3: Detailed Report */}\r\n-      {/* \"Data Down\": Pass the sentences */}\r\n-      {/* \"Event Up\": Pass the handler function */}\r\n-      <ReportVisualizer \r\n-        sentences={reportData.document_visualizer}\r\n-        onRewriteClick={handleRewriteClick} \r\n-      />\r\n+        {/* Component #3: Detailed Report */}\r\n+        <ReportVisualizer \r\n+          sentences={reportData.document_visualizer}\r\n+          onRewriteClick={handleRewriteClick} \r\n+        />\r\n+      </div> {/* End of #report-to-download wrapper */}\r\n \r\n+\r\n       {/* Component #1: Rewrite Modal (hidden by default) */}\r\n       <RewriteModal \r\n         isOpen={isModalOpen}\r\n         onClose={() => setIsModalOpen(false)}\r\n"
                },
                {
                    "date": 1762524829428,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,103 +1,196 @@\n-import React, { useState, useEffect } from 'react';\r\n-import { useLocation, Link } from 'react-router-dom';\r\n+// frontend/src/pages/Dashboard.js\r\n \r\n-// 1. Import all your new components\r\n-import ReportVisualizer from '../components/Report/ReportVisualizer';\r\n-import ScoreDonut from '../components/Chart/ScoreDonut';\r\n-import RewriteModal from '../components/Actions/RewriteModal';\r\n-import DownloadButton from '../components/Actions/DownloadButton';\r\n+import React, { useState, useRef } from 'react';\r\n+import axios from 'axios';\r\n \r\n-// Basic styles for the dashboard layout\r\n-const dashboardStyles = {\r\n-  padding: '2rem',\r\n-  fontFamily: 'Arial, sans-serif',\r\n-  maxWidth: '1200px',\r\n-  margin: '0 auto'\r\n-};\r\n+const Dashboard = () => {\r\n+    const [file, setFile] = useState(null);\r\n+    const [analysisResult, setAnalysisResult] = useState(null);\r\n+    const [message, setMessage] = useState('');\r\n+    const [isLoading, setIsLoading] = useState(false);\r\n+    const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n+    const [rewritingIndex, setRewritingIndex] = useState(null);\r\n+    const fileInputRef = useRef(null);\r\n \r\n-const summaryStyles = {\r\n-  display: 'flex',\r\n-  justifyContent: 'space-around',\r\n-  alignItems: 'center',\r\n-  flexWrap: 'wrap',\r\n-  gap: '2rem',\r\n-  marginBottom: '2rem'\r\n-};\r\n+    // 1. Helper function to get the auth token from local storage\r\n+    const getAuthToken = () => {\r\n+        const user = JSON.parse(localStorage.getItem('user'));\r\n+        return user ? user.token : null;\r\n+    };\r\n \r\n-function Dashboard() {\r\n-  // --- STATE ---\r\n-  const [reportData, setReportData] = useState(null);\r\n-  const [isLoading, setIsLoading] = useState(true);\r\n-  \r\n-  const [isModalOpen, setIsModalOpen] = useState(false);\r\n-  const [sentenceToRewrite, setSentenceToRewrite] = useState('');\r\n+    const onFileChange = e => {\r\n+        setFile(e.target.files[0]);\r\n+    };\r\n \r\n-  const location = useLocation();\r\n+    const onFormSubmit = async e => {\r\n+        e.preventDefault();\r\n+        setIsLoading(true);\r\n+        setMessage('Uploading and analyzing...');\r\n+        setAnalysisResult(null);\r\n+        setRewriteSuggestions({});\r\n \r\n-  useEffect(() => {\r\n-    if (location.state && location.state.report) {\r\n-      setReportData(location.state.report);\r\n-      setIsLoading(false);\r\n-    } else {\r\n-      console.error(\"No report data found!\");\r\n-      setIsLoading(false);\r\n-    }\r\n-  }, [location]);\r\n+        if (!file) {\r\n+            setMessage('Please select a file first.');\r\n+            setIsLoading(false);\r\n+            return;\r\n+        }\r\n \r\n-  // This function is passed down to ReportVisualizer\r\n-  const handleRewriteClick = (sentence) => {\r\n-    setSentenceToRewrite(sentence);\r\n-    setIsModalOpen(true);\r\n-  };\r\n+        try {\r\n+            const token = getAuthToken();\r\n+            if (!token) {\r\n+                setMessage('Authorization error. Please log in again.');\r\n+                setIsLoading(false);\r\n+                return;\r\n+            }\r\n \r\n-  if (isLoading) {\r\n-    return <div>Loading report...</div>;\r\n-  }\r\n+            const formData = new FormData();\r\n+            formData.append('document', file);\r\n+            \r\n+            // 2. Create a config object with the auth token in the headers\r\n+            const config = {\r\n+                headers: {\r\n+                    'Content-Type': 'multipart/form-data',\r\n+                    'x-auth-token': token\r\n+                }\r\n+            };\r\n \r\n\\ No newline at end of file\n-  if (!reportData) {\r\n-    return (\r\n-      <div style={dashboardStyles}>\r\n-        <h1>Error</h1>\r\n-        <p>Could not load report data. Please try analyzing again.</p>\r\n-        <Link to=\"/\">Go back to Home</Link>\r\n-      </div>\r\n-    );\r\n-  }\r\n+            // 3. Pass the config object with the request\r\n+            const response = await axios.post('http://localhost:5000/api/documents/upload', formData, config);\r\n \r\n-  // --- RENDER ---\r\n-  return (\r\n-    <div style={dashboardStyles}>\r\n-      \r\n-      {/* This is the wrapper for the PDF download */}\r\n-      <div id=\"report-to-download\">\r\n-        <h1 style={{ textAlign: 'center' }}>Plagiarism Report</h1>\r\n-        \r\n-        <div style={summaryStyles}>\r\n-          {/* Component #4: Donut Chart */}\r\n-          <ScoreDonut score={reportData.overall_score} />\r\n+            setAnalysisResult(response.data);\r\n+            setMessage('Analysis Complete!');\r\n+        } catch (error) {\r\n+            console.error('File upload error:', error);\r\n+            setMessage('Analysis failed. Your session may have expired.');\r\n+        } finally {\r\n+            setIsLoading(false);\r\n+        }\r\n+    };\r\n \r\n-          {/* Component #2: Download Button */}\r\n-          <DownloadButton targetId=\"report-to-download\" />\r\n-        </div>\r\n-        \r\n-        <hr style={{ margin: '2rem 0' }} />\r\n+    const handleRewrite = async (sentence, index) => {\r\n+        setRewritingIndex(index);\r\n+        try {\r\n+            const token = getAuthToken();\r\n+            if (!token) {\r\n+                setRewriteSuggestions(prev => ({ ...prev, [index]: \"Authorization error.\" }));\r\n+                return;\r\n+            }\r\n \r\n-        {/* Component #3: Detailed Report */}\r\n-        <ReportVisualizer \r\n-          sentences={reportData.document_visualizer}\r\n-          onRewriteClick={handleRewriteClick} \r\n-        />\r\n-      </div> {/* End of #report-to-download wrapper */}\r\n+            // 4. Create config object for the rewrite request\r\n+            const config = {\r\n+                headers: {\r\n+                    'Content-Type': 'application/json',\r\n+                    'x-auth-token': token\r\n+                }\r\n+            };\r\n \r\n+            // 5. Pass the config object with the request\r\n+            const response = await axios.post('http://localhost:5000/api/documents/rewrite', { sentence }, config);\r\n+            setRewriteSuggestions(prev => ({\r\n+                ...prev,\r\n+                [index]: response.data.rewritten_text\r\n+            }));\r\n+        } catch (error) {\r\n+            console.error('Rewrite error:', error);\r\n+            setRewriteSuggestions(prev => ({\r\n+                ...prev,\r\n+                [index]: \"Error getting suggestion.\"\r\n+            }));\r\n+        } finally {\r\n+            setRewritingIndex(null);\r\n+        }\r\n+    };\r\n \r\n-      {/* Component #1: Rewrite Modal (hidden by default) */}\r\n-      <RewriteModal \r\n-        isOpen={isModalOpen}\r\n-        onClose={() => setIsModalOpen(false)}\r\n-        sentence={sentenceToRewrite}\r\n-      />\r\n-    </div>\r\n-  );\r\n-}\r\n+    const handleClear = () => {\r\n+        setFile(null);\r\n+        setAnalysisResult(null);\r\n+        setMessage('');\r\n+        setRewriteSuggestions({});\r\n+        if (fileInputRef.current) {\r\n+            fileInputRef.current.value = \"\";\r\n+        }\r\n+    };\r\n \r\n-export default Dashboard;\n+    return (\r\n+        <div className=\"container mx-auto mt-10 p-4\">\r\n+            <div className=\"w-full max-w-2xl mx-auto p-6 sm:p-8 space-y-6 bg-white rounded-lg shadow-md\">\r\n+                <h2 className=\"text-2xl font-bold text-center\">Dashboard</h2>\r\n+                <form onSubmit={onFormSubmit} className=\"space-y-4\">\r\n+                    <div>\r\n+                        <label htmlFor=\"file-upload\" className=\"block text-sm font-medium text-gray-700\">\r\n+                            Upload your document\r\n+                        </label>\r\n+                        <div className=\"mt-1 flex items-center\">\r\n+                            <input\r\n+                                type=\"file\"\r\n+                                ref={fileInputRef}\r\n+                                onChange={onFileChange}\r\n+                                \r\n+                                disabled={isLoading}\r\n+                                className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 disabled:opacity-50\"\r\n+                            />\r\n+                        </div>\r\n+                    </div>\r\n+                    <button\r\n+                        type=\"submit\"\r\n+                        disabled={isLoading}\r\n+                        className=\"w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 disabled:cursor-not-allowed\"\r\n+                    >\r\n+                        {isLoading ? 'Analyzing...' : 'Upload & Analyze'}\r\n+                    </button>\r\n+                </form>\r\n+\r\n+                {message && !isLoading && <p className=\"text-center text-sm text-gray-600 mt-4\">{message}</p>}\r\n+            </div>\r\n+\r\n+            {analysisResult && (\r\n+                <div className=\"w-full max-w-2xl mx-auto mt-8 p-6 sm:p-8 bg-white rounded-lg shadow-md\">\r\n+                    <div className=\"flex justify-between items-center mb-4\">\r\n+                        <h3 className=\"text-xl font-bold\">Analysis Report</h3>\r\n+                        <button \r\n+                            onClick={handleClear}\r\n+                            className=\"px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200\"\r\n+                        >\r\n+                            Clear\r\n+                        </button>\r\n+                    </div>\r\n+                    <p className=\"text-lg mb-4\"><strong>Overall Plagiarism Score:</strong> {analysisResult.overall_score}%</p>\r\n+                    <h4 className=\"text-lg font-semibold mb-2\">Flagged Sections:</h4>\r\n+                    <div className=\"space-y-4\">\r\n+                        {analysisResult.flagged_sections.length > 0 ? (\r\n+                            analysisResult.flagged_sections.map((section, index) => (\r\n+                                <div key={index} className=\"border border-gray-200 p-4 rounded-md\">\r\n+                                    <p className=\"text-gray-700 italic\">\"{section.text}\"</p>\r\n+                                    <p className=\"text-sm mt-2\">\r\n+                                        <strong>Source:</strong> <span className=\"text-gray-600\">{section.source}</span>\r\n+                                    </p>\r\n+                                    <p className=\"text-sm\">\r\n+                                        <strong>Similarity:</strong> <span className=\"font-semibold text-indigo-600\">{section.similarity}% ({section.type})</span>\r\n+                                    </p>\r\n+                                    <div className=\"mt-3\">\r\n+                                        <button\r\n+                                            onClick={() => handleRewrite(section.text, index)}\r\n+                                            disabled={rewritingIndex === index}\r\n+                                            className=\"text-sm font-medium text-indigo-600 hover:text-indigo-800 disabled:opacity-50 disabled:cursor-wait\"\r\n+                                        >\r\n+                                            {rewritingIndex === index ? 'Generating...' : 'âœ¨ Suggest Rewrite'}\r\n+                                        </button>\r\n+                                        {rewriteSuggestions[index] && (\r\n+                                            <div className=\"mt-2 p-3 bg-indigo-50 rounded-md\">\r\n+                                                <p className=\"text-sm text-gray-800\">{rewriteSuggestions[index]}</p>\r\n+                                            </div>\r\n+                                        )}\r\n+                                    </div>\r\n+                                </div>\r\n+                            ))\r\n+                        ) : (\r\n+                            <p className=\"text-gray-500\">No plagiarized sections found.</p>\r\n+                        )}\r\n+                    </div>\r\n+                </div>\r\n+            )}\r\n+        </div>\r\n+    );\r\n+};\r\n+\r\n+export default Dashboard;\r\n"
                },
                {
                    "date": 1762524835256,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,9 +124,9 @@\n                             <input\r\n                                 type=\"file\"\r\n                                 ref={fileInputRef}\r\n                                 onChange={onFileChange}\r\n-                                \r\n+                                accept=\".txt,.pdf,.docx\"\r\n                                 disabled={isLoading}\r\n                                 className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 disabled:opacity-50\"\r\n                             />\r\n                         </div>\r\n@@ -192,5 +192,5 @@\n         </div>\r\n     );\r\n };\r\n \r\n-export default Dashboard;\n\\ No newline at end of file\n+export default Dashboard;\r\n"
                },
                {
                    "date": 1762524841128,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,9 +124,9 @@\n                             <input\r\n                                 type=\"file\"\r\n                                 ref={fileInputRef}\r\n                                 onChange={onFileChange}\r\n-                                accept=\".txt,.pdf,.docx\"\r\n+                                accept=\".txt,.pdf,.docx, +\"\r\n                                 disabled={isLoading}\r\n                                 className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 disabled:opacity-50\"\r\n                             />\r\n                         </div>\r\n"
                },
                {
                    "date": 1762524858383,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,9 +124,9 @@\n                             <input\r\n                                 type=\"file\"\r\n                                 ref={fileInputRef}\r\n                                 onChange={onFileChange}\r\n-                                accept=\".txt,.pdf,.docx, +\"\r\n+                                accept=\".txt,.pdf,.docx,.doc\"\r\n                                 disabled={isLoading}\r\n                                 className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 disabled:opacity-50\"\r\n                             />\r\n                         </div>\r\n"
                },
                {
                    "date": 1762525112419,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,11 @@\n-// frontend/src/pages/Dashboard.js\r\n-\r\n import React, { useState, useRef } from 'react';\r\n import axios from 'axios';\r\n \r\n+// NEW: Import PDF generation libraries\r\n+import jsPDF from 'jspdf';\r\n+import autoTable from 'jspdf-autotable';\r\n+\r\n const Dashboard = () => {\r\n     const [file, setFile] = useState(null);\r\n     const [analysisResult, setAnalysisResult] = useState(null);\r\n     const [message, setMessage] = useState('');\r\n@@ -11,16 +13,17 @@\n     const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n     const [rewritingIndex, setRewritingIndex] = useState(null);\r\n     const fileInputRef = useRef(null);\r\n \r\n-    // 1. Helper function to get the auth token from local storage\r\n     const getAuthToken = () => {\r\n         const user = JSON.parse(localStorage.getItem('user'));\r\n         return user ? user.token : null;\r\n     };\r\n \r\n     const onFileChange = e => {\r\n         setFile(e.target.files[0]);\r\n+        setAnalysisResult(null); // Clear old results\r\n+        setMessage('');\r\n     };\r\n \r\n     const onFormSubmit = async e => {\r\n         e.preventDefault();\r\n@@ -34,139 +37,202 @@\n             setIsLoading(false);\r\n             return;\r\n         }\r\n \r\n+        const formData = new FormData();\r\n+        formData.append('document', file);\r\n+        const token = getAuthToken();\r\n+\r\n+        if (!token) {\r\n+            setMessage('Authorization error. Please log in again.');\r\n+            setIsLoading(false);\r\n+            return;\r\n+        }\r\n+\r\n         try {\r\n-            const token = getAuthToken();\r\n-            if (!token) {\r\n-                setMessage('Authorization error. Please log in again.');\r\n-                setIsLoading(false);\r\n-                return;\r\n-            }\r\n-\r\n-            const formData = new FormData();\r\n-            formData.append('document', file);\r\n-            \r\n-            // 2. Create a config object with the auth token in the headers\r\n-            const config = {\r\n+            // Use the correct documentService URL from our backend\r\n+            const response = await axios.post('http://localhost:5000/api/documents/upload', formData, {\r\n                 headers: {\r\n                     'Content-Type': 'multipart/form-data',\r\n                     'x-auth-token': token\r\n                 }\r\n-            };\r\n-\r\n-            // 3. Pass the config object with the request\r\n-            const response = await axios.post('http://localhost:5000/api/documents/upload', formData, config);\r\n-\r\n+            });\r\n             setAnalysisResult(response.data);\r\n-            setMessage('Analysis Complete!');\r\n+            setMessage('Analysis complete.');\r\n         } catch (error) {\r\n-            console.error('File upload error:', error);\r\n-            setMessage('Analysis failed. Your session may have expired.');\r\n-        } finally {\r\n-            setIsLoading(false);\r\n+            console.error('Upload error:', error.response?.data || error.message);\r\n+            setMessage('Analysis failed: ' + (error.response?.data || 'Server error.'));\r\n         }\r\n+        setIsLoading(false);\r\n     };\r\n \r\n     const handleRewrite = async (sentence, index) => {\r\n         setRewritingIndex(index);\r\n         try {\r\n             const token = getAuthToken();\r\n-            if (!token) {\r\n-                setRewriteSuggestions(prev => ({ ...prev, [index]: \"Authorization error.\" }));\r\n-                return;\r\n-            }\r\n+            const response = await axios.post('http://localhost:5000/api/documents/rewrite', \r\n+                { sentence },\r\n+                { headers: { 'x-auth-token': token } }\r\n+            );\r\n \r\n-            // 4. Create config object for the rewrite request\r\n-            const config = {\r\n-                headers: {\r\n-                    'Content-Type': 'application/json',\r\n-                    'x-auth-token': token\r\n-                }\r\n-            };\r\n-\r\n-            // 5. Pass the config object with the request\r\n-            const response = await axios.post('http://localhost:5000/api/documents/rewrite', { sentence }, config);\r\n             setRewriteSuggestions(prev => ({\r\n                 ...prev,\r\n                 [index]: response.data.rewritten_text\r\n             }));\r\n         } catch (error) {\r\n             console.error('Rewrite error:', error);\r\n             setRewriteSuggestions(prev => ({\r\n                 ...prev,\r\n-                [index]: \"Error getting suggestion.\"\r\n+                [index]: 'Error generating suggestion.'\r\n             }));\r\n-        } finally {\r\n-            setRewritingIndex(null);\r\n         }\r\n+        setRewritingIndex(null);\r\n     };\r\n \r\n-    const handleClear = () => {\r\n-        setFile(null);\r\n-        setAnalysisResult(null);\r\n-        setMessage('');\r\n-        setRewriteSuggestions({});\r\n-        if (fileInputRef.current) {\r\n-            fileInputRef.current.value = \"\";\r\n-        }\r\n+    // --- NEW: PDF DOWNLOAD FUNCTION ---\r\n+    const handleDownloadPDF = () => {\r\n+        if (!analysisResult) return;\r\n+\r\n+        const doc = new jsPDF();\r\n+        const user = JSON.parse(localStorage.getItem('user'));\r\n+\r\n+        // 1. Title\r\n+        doc.setFont('helvetica', 'bold');\r\n+        doc.setFontSize(20);\r\n+        doc.text('Plagiarism Analysis Report', 105, 20, { align: 'center' });\r\n+\r\n+        // 2. Summary Info\r\n+        doc.setFont('helvetica', 'normal');\r\n+        doc.setFontSize(12);\r\n+        doc.text(`Report for: ${user?.name || 'User'}`, 14, 35);\r\n+        doc.text(`Analyzed File: ${file?.name || 'N/A'}`, 14, 42);\r\n+        doc.text(`Date: ${new Date().toLocaleDateString()}`, 14, 49);\r\n+\r\n+        // 3. Overall Score\r\n+        doc.setFont('helvetica', 'bold');\r\n+        doc.text('Overall Similarity Score:', 14, 60);\r\n+        doc.setFont('helvetica', 'bold');\r\n+        doc.setTextColor(211, 47, 47); // Red color\r\n+        doc.setFontSize(16);\r\n+        doc.text(`${analysisResult.overall_score}%`, 75, 60);\r\n+\r\n+        doc.setTextColor(0, 0, 0); // Reset color\r\n+        doc.setFontSize(12);\r\n+\r\n+        // 4. Details Table\r\n+        doc.setFont('helvetica', 'bold');\r\n+        doc.text('Flagged Sections:', 14, 75);\r\n+\r\n+        const tableColumn = [\"Similarity\", \"Type\", \"Flagged Text\", \"Source\"];\r\n+        const tableRows = [];\r\n+\r\n+        analysisResult.flagged_sections.forEach(section => {\r\n+            const row = [\r\n+                `${section.similarity}%`,\r\n+                section.type,\r\n+                section.text,\r\n+                section.source\r\n+            ];\r\n+            tableRows.push(row);\r\n+        });\r\n+\r\n+        autoTable(doc, {\r\n+            startY: 80,\r\n+            head: [tableColumn],\r\n+            body: tableRows,\r\n+            theme: 'striped',\r\n+            headStyles: { fillColor: [41, 128, 185] }, // Blue header\r\n+            didDrawCell: (data) => {\r\n+                // Handle text wrapping for long sentences\r\n+                if (data.column.index === 2 || data.column.index === 3) {\r\n+                    doc.setFontSize(8);\r\n+                }\r\n+            }\r\n+        });\r\n+\r\n+        // 5. Full Text (on a new page)\r\n+        doc.addPage();\r\n+        doc.setFont('helvetica', 'bold');\r\n+        doc.setFontSize(16);\r\n+        doc.text('Full Submitted Text', 14, 20);\r\n+\r\n+        doc.setFont('helvetica', 'normal');\r\n+        doc.setFontSize(9);\r\n+        // Split text to handle page breaks\r\n+        const splitText = doc.splitTextToSize(analysisResult.full_text, 180);\r\n+        doc.text(splitText, 14, 30);\r\n+\r\n+        // 6. Save\r\n+        doc.save(`Plagiarism_Report_${file?.name || 'analysis'}.pdf`);\r\n     };\r\n \r\n     return (\r\n-        <div className=\"container mx-auto mt-10 p-4\">\r\n-            <div className=\"w-full max-w-2xl mx-auto p-6 sm:p-8 space-y-6 bg-white rounded-lg shadow-md\">\r\n-                <h2 className=\"text-2xl font-bold text-center\">Dashboard</h2>\r\n-                <form onSubmit={onFormSubmit} className=\"space-y-4\">\r\n-                    <div>\r\n-                        <label htmlFor=\"file-upload\" className=\"block text-sm font-medium text-gray-700\">\r\n-                            Upload your document\r\n-                        </label>\r\n-                        <div className=\"mt-1 flex items-center\">\r\n-                            <input\r\n-                                type=\"file\"\r\n-                                ref={fileInputRef}\r\n-                                onChange={onFileChange}\r\n-                                accept=\".txt,.pdf,.docx,.doc\"\r\n-                                disabled={isLoading}\r\n-                                className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 disabled:opacity-50\"\r\n-                            />\r\n-                        </div>\r\n-                    </div>\r\n+        <div className=\"container mx-auto px-4 py-12 max-w-4xl\">\r\n+            <h1 className=\"text-3xl font-bold text-gray-800 mb-6\">My Dashboard</h1>\r\n+\r\n+            {/* File Upload Section */}\r\n+            <form onSubmit={onFormSubmit} className=\"bg-white p-6 rounded-lg shadow-md mb-8\">\r\n+                <h2 className=\"text-xl font-semibold mb-4\">Check a New Document</h2>\r\n+                <div className=\"flex items-center space-x-4\">\r\n                     <button\r\n-                        type=\"submit\"\r\n-                        disabled={isLoading}\r\n-                        className=\"w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 disabled:cursor-not-allowed\"\r\n+                        type=\"button\"\r\n+                        onClick={() => fileInputRef.current.click()}\r\n+                        className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 border border-gray-300\"\r\n                     >\r\n-                        {isLoading ? 'Analyzing...' : 'Upload & Analyze'}\r\n+                        Choose File\r\n                     </button>\r\n-                </form>\r\n+                    <span className=\"text-gray-500\">{file ? file.name : 'No file selected.'}</span>\r\n+                    <input\r\n+                        type=\"file\"\r\n+                        className=\"hidden\"\r\n+                        onChange={onFileChange}\r\n+                        ref={fileInputRef}\r\n+                        accept=\".txt,.pdf,.doc,.docx\" // <-- UPDATED\r\n+                    />\r\n+                </div>\r\n+                <p className=\"text-xs text-gray-400 mt-2\">Accepted formats: .txt, .pdf, .docx, .doc</p>\r\n \r\n-                {message && !isLoading && <p className=\"text-center text-sm text-gray-600 mt-4\">{message}</p>}\r\n-            </div>\r\n+                <button\r\n+                    type=\"submit\"\r\n+                    disabled={isLoading || !file}\r\n+                    className=\"mt-4 w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n+                >\r\n+                    {isLoading ? 'Analyzing...' : 'Start Analysis'}\r\n+                </button>\r\n+                {message && <p className=\"mt-4 text-center text-gray-600\">{message}</p>}\r\n+            </form>\r\n \r\n+            {/* Analysis Result Section */}\r\n             {analysisResult && (\r\n-                <div className=\"w-full max-w-2xl mx-auto mt-8 p-6 sm:p-8 bg-white rounded-lg shadow-md\">\r\n+                <div className=\"bg-white p-6 rounded-lg shadow-md\">\r\n                     <div className=\"flex justify-between items-center mb-4\">\r\n-                        <h3 className=\"text-xl font-bold\">Analysis Report</h3>\r\n-                        <button \r\n-                            onClick={handleClear}\r\n-                            className=\"px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200\"\r\n+                        <h2 className=\"text-2xl font-semibold\">Analysis Report</h2>\r\n+                        {/* --- NEW: DOWNLOAD BUTTON --- */}\r\n+                        <button\r\n+                            onClick={handleDownloadPDF}\r\n+                            className=\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700\"\r\n                         >\r\n-                            Clear\r\n+                            Download Report (PDF)\r\n                         </button>\r\n                     </div>\r\n-                    <p className=\"text-lg mb-4\"><strong>Overall Plagiarism Score:</strong> {analysisResult.overall_score}%</p>\r\n-                    <h4 className=\"text-lg font-semibold mb-2\">Flagged Sections:</h4>\r\n-                    <div className=\"space-y-4\">\r\n+                    <div className=\"mb-6 border-b pb-4\">\r\n+                        <span className=\"text-gray-600 font-medium\">Overall Similarity Score:</span>\r\n+                        <span className=\"ml-2 text-3xl font-bold text-red-600\">{analysisResult.overall_score}%</span>\r\n+                    </div>\r\n+\r\n+                    <h3 className=\"text-xl font-semibold mb-4\">Flagged Sections</h3>\r\n+                    <div className=\"space-y-6\">\r\n                         {analysisResult.flagged_sections.length > 0 ? (\r\n                             analysisResult.flagged_sections.map((section, index) => (\r\n-                                <div key={index} className=\"border border-gray-200 p-4 rounded-md\">\r\n-                                    <p className=\"text-gray-700 italic\">\"{section.text}\"</p>\r\n-                                    <p className=\"text-sm mt-2\">\r\n-                                        <strong>Source:</strong> <span className=\"text-gray-600\">{section.source}</span>\r\n+                                <div key={index} className=\"border p-4 rounded-md bg-gray-50\">\r\n+                                    <p className=\"text-gray-800 leading-relaxed\">\"{section.text}\"</p>\r\n+                                    <p className=\"text-sm mt-3\">\r\n+                                        <span className=\"font-semibold text-red-700\">Source:</span>\r\n+                                        <span className=\"ml-2 text-gray-600\">{section.source}</span>\r\n                                     </p>\r\n-                                    <p className=\"text-sm\">\r\n-                                        <strong>Similarity:</strong> <span className=\"font-semibold text-indigo-600\">{section.similarity}% ({section.type})</span>\r\n+                                    <p className=\"text-sm mt-1\">\r\n+                                        <span className=\"font-semibold text-red-700\">Similarity:</span>\r\n+                                        <span className=\"ml-2 text-gray-600\">{section.similarity}% ({section.type})</span>\r\n                                     </p>\r\n                                     <div className=\"mt-3\">\r\n                                         <button\r\n                                             onClick={() => handleRewrite(section.text, index)}\r\n@@ -192,5 +258,5 @@\n         </div>\r\n     );\r\n };\r\n \r\n-export default Dashboard;\r\n+export default Dashboard;\n\\ No newline at end of file\n"
                }
            ],
            "date": 1762431573360,
            "name": "Commit-0",
            "content": "// frontend/src/pages/Dashboard.js\r\n"
        }
    ]
}