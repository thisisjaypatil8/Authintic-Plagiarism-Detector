{
    "sourceFile": "frontend/src/components/VisualReport.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1762593220606,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762595589735,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,20 @@\n import axios from 'axios';\r\n \r\n // This component ONLY renders the visual text and manages its own tooltip\r\n const VisualReport = ({ structuredText }) => {\r\n-    const [tooltip, setTooltip] = useState({ visible: false, content: null, x: 0, y: 0 });\r\n+    // --- STATE MODIFICATION ---\r\n+    // We no longer store 'content' (the JSX) in state.\r\n+    // We now store 'item' and 'index' (the data)\r\n+    const [tooltip, setTooltip] = useState({\r\n+        visible: false,\r\n+        item: null,\r\n+        index: null,\r\n+        x: 0,\r\n+        y: 0,\r\n+    });\r\n+    // --- END MODIFICATION ---\r\n+\r\n     const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n     const [rewritingIndex, setRewritingIndex] = useState(null);\r\n \r\n     const getAuthToken = () => {\r\n@@ -35,65 +46,71 @@\n         }\r\n         setRewritingIndex(null);\r\n     };\r\n \r\n+    // --- CLICK HANDLER MODIFICATION ---\r\n+    // This is now much simpler. It just saves the item, index, and position.\r\n     const handleHighlightClick = (e, item, index) => {\r\n         if (!item.plagiarized) {\r\n             setTooltip({ visible: false });\r\n             return;\r\n         }\r\n \r\n-        const tooltipContent = (\r\n-            <div className=\"p-2 text-sm\">\r\n-                <p>\r\n-                    <span className=\"font-bold\">{item.type}</span>\r\n-                    <span className={`ml-2 font-bold ${item.type === 'Direct Match' ? 'text-red-300' : 'text-yellow-300'}`}>\r\n-                        ({item.similarity}%)\r\n-                    </span>\r\n-                </p>\r\n-                <p className=\"mt-2 text-gray-300\">\r\n-                    <span className=\"font-semibold\">Source:</span> {item.source}\r\n-                </p>\r\n-                <div className=\"mt-3\">\r\n-                    <button\r\n-                        onClick={(e) => {\r\n-                            e.stopPropagation();\r\n-                            handleRewrite(item.text, index);\r\n-                        }}\r\n-                        disabled={rewritingIndex === index}\r\n-                        className=\"text-sm font-medium text-indigo-400 hover:text-indigo-300 disabled:opacity-50 disabled:cursor-wait\"\r\n-                    >\r\n-                        {rewritingIndex === index ? 'Generating...' : '✨ Suggest Rewrite'}\r\n-                    </button>\r\n-                    {rewriteSuggestions[index] && (\r\n-                        <div className=\"mt-2 p-3 bg-gray-700 rounded-md\">\r\n-                            <p className=\"text-sm text-white\">{rewriteSuggestions[index]}</p>\r\n-                        </div>\r\n-                    )}\r\n-                </div>\r\n-            </div>\r\n-        );\r\n-\r\n         const rect = e.target.getBoundingClientRect();\r\n         setTooltip({\r\n             visible: true,\r\n-            content: tooltipContent,\r\n+            item: item,     // Store the data, not the JSX\r\n+            index: index,   // Store the data, not the JSX\r\n             x: window.scrollX + rect.left + rect.width / 2,\r\n             y: window.scrollY + rect.top,\r\n         });\r\n     };\r\n+    // --- END MODIFICATION ---\r\n \r\n     return (\r\n         <div onClick={() => setTooltip({ visible: false })}>\r\n-            {tooltip.visible && (\r\n+            {/* --- TOOLTIP RENDER MODIFICATION --- */}\r\n+            {/* The tooltip's content is now rendered LIVE, so it always\r\n+                has access to the latest 'rewriteSuggestions' state. */}\r\n+            {tooltip.visible && tooltip.item && (\r\n                 <div\r\n                     className=\"tooltip visible\"\r\n                     style={{ left: `${tooltip.x}px`, top: `${tooltip.y}px` }}\r\n                     onClick={(e) => e.stopPropagation()}\r\n                 >\r\n-                    {tooltip.content}\r\n+                    <div className=\"p-2 text-sm\">\r\n+                        <p>\r\n+                            <span className=\"font-bold\">{tooltip.item.type}</span>\r\n+                            <span className={`ml-2 font-bold ${tooltip.item.type === 'Direct Match' ? 'text-red-300' : 'text-yellow-300'}`}>\r\n+                                ({tooltip.item.similarity}%)\r\n+                            </span>\r\n+                        </p>\r\n+                        <p className=\"mt-2 text-gray-300\">\r\n+                            <span className=\"font-semibold\">Source:</span> {tooltip.item.source}\r\n+                        </p>\r\n+                        <div className=\"mt-3\">\r\n+                            <button\r\n+                                onClick={(e) => {\r\n+                                    e.stopPropagation();\r\n+                                    handleRewrite(tooltip.item.text, tooltip.index);\r\n+                                }}\r\n+                                disabled={rewritingIndex === tooltip.index}\r\n+                                className=\"text-sm font-medium text-indigo-400 hover:text-indigo-300 disabled:opacity-50 disabled:cursor-wait\"\r\n+                            >\r\n+                                {rewritingIndex === tooltip.index ? 'Generating...' : '✨ Suggest Rewrite'}\r\n+                            </button>\r\n+                            \r\n+                            {/* This block will now correctly update when rewriteSuggestions[tooltip.index] changes */}\r\n+                            {rewriteSuggestions[tooltip.index] && (\r\n+                                <div className=\"mt-2 p-3 bg-gray-700 rounded-md\">\r\n+                                    <p className=\"text-sm text-white\">{rewriteSuggestions[tooltip.index]}</p>\r\n+                                </div>\r\n+                            )}\r\n+                        </div>\r\n+                    </div>\r\n                 </div>\r\n             )}\r\n+            {/* --- END MODIFICATION --- */}\r\n \r\n             <h3 className=\"text-xl font-semibold mb-4\">Highlighted Document</h3>\r\n             <p className=\"text-sm text-gray-500 mb-4\">Click on a highlighted section for details and rewrite options.</p>\r\n             <div className=\"border p-4 rounded-md bg-gray-50 leading-relaxed whitespace-pre-wrap\">\r\n"
                },
                {
                    "date": 1762600500377,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,24 +1,32 @@\n-import React, { useState } from 'react';\r\n+import React, { useState, useEffect } from 'react';\r\n import axios from 'axios';\r\n \r\n-// This component ONLY renders the visual text and manages its own tooltip\r\n-const VisualReport = ({ structuredText }) => {\r\n-    // --- STATE MODIFICATION ---\r\n-    // We no longer store 'content' (the JSX) in state.\r\n-    // We now store 'item' and 'index' (the data)\r\n+// This component displays the colored-text report\r\n+const VisualReport = ({ structuredText, onRewrite }) => {\r\n     const [tooltip, setTooltip] = useState({\r\n         visible: false,\r\n-        item: null,\r\n-        index: null,\r\n+        content: null,\r\n         x: 0,\r\n         y: 0,\r\n+        index: null,\r\n     });\r\n-    // --- END MODIFICATION ---\r\n-\r\n     const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n     const [rewritingIndex, setRewritingIndex] = useState(null);\r\n \r\n+    // Hide tooltip when clicking anywhere else\r\n+    useEffect(() => {\r\n+        const handleClickOutside = (e) => {\r\n+            if (tooltip.visible && !e.target.closest('.tooltip-container')) {\r\n+                setTooltip({ ...tooltip, visible: false });\r\n+            }\r\n+        };\r\n+        document.addEventListener('mousedown', handleClickOutside);\r\n+        return () => {\r\n+            document.removeEventListener('mousedown', handleClickOutside);\r\n+        };\r\n+    }, [tooltip]);\r\n+\r\n     const getAuthToken = () => {\r\n         const user = JSON.parse(localStorage.getItem('user'));\r\n         return user ? user.token : null;\r\n     };\r\n@@ -46,94 +54,92 @@\n         }\r\n         setRewritingIndex(null);\r\n     };\r\n \r\n-    // --- CLICK HANDLER MODIFICATION ---\r\n-    // This is now much simpler. It just saves the item, index, and position.\r\n-    const handleHighlightClick = (e, item, index) => {\r\n-        if (!item.plagiarized) {\r\n-            setTooltip({ visible: false });\r\n-            return;\r\n-        }\r\n+    const handleHighlightClick = (e, segment, index) => {\r\n+        if (!segment.plagiarized) return;\r\n \r\n         const rect = e.target.getBoundingClientRect();\r\n+        \r\n         setTooltip({\r\n             visible: true,\r\n-            item: item,     // Store the data, not the JSX\r\n-            index: index,   // Store the data, not the JSX\r\n-            x: window.scrollX + rect.left + rect.width / 2,\r\n-            y: window.scrollY + rect.top,\r\n+            // We set the *data* for the tooltip here\r\n+            content: segment,\r\n+            index: index,\r\n+            // Position tooltip above the click\r\n+            x: e.clientX,\r\n+            y: rect.top + window.scrollY,\r\n         });\r\n     };\r\n-    // --- END MODIFICATION ---\r\n \r\n     return (\r\n-        <div onClick={() => setTooltip({ visible: false })}>\r\n-            {/* --- TOOLTIP RENDER MODIFICATION --- */}\r\n-            {/* The tooltip's content is now rendered LIVE, so it always\r\n-                has access to the latest 'rewriteSuggestions' state. */}\r\n-            {tooltip.visible && tooltip.item && (\r\n-                <div\r\n-                    className=\"tooltip visible\"\r\n-                    style={{ left: `${tooltip.x}px`, top: `${tooltip.y}px` }}\r\n-                    onClick={(e) => e.stopPropagation()}\r\n-                >\r\n-                    <div className=\"p-2 text-sm\">\r\n-                        <p>\r\n-                            <span className=\"font-bold\">{tooltip.item.type}</span>\r\n-                            <span className={`ml-2 font-bold ${tooltip.item.type === 'Direct Match' ? 'text-red-300' : 'text-yellow-300'}`}>\r\n-                                ({tooltip.item.similarity}%)\r\n-                            </span>\r\n-                        </p>\r\n-                        <p className=\"mt-2 text-gray-300\">\r\n-                            <span className=\"font-semibold\">Source:</span> {tooltip.item.source}\r\n-                        </p>\r\n-                        <div className=\"mt-3\">\r\n-                            <button\r\n-                                onClick={(e) => {\r\n-                                    e.stopPropagation();\r\n-                                    handleRewrite(tooltip.item.text, tooltip.index);\r\n-                                }}\r\n-                                disabled={rewritingIndex === tooltip.index}\r\n-                                className=\"text-sm font-medium text-indigo-400 hover:text-indigo-300 disabled:opacity-50 disabled:cursor-wait\"\r\n-                            >\r\n-                                {rewritingIndex === tooltip.index ? 'Generating...' : '✨ Suggest Rewrite'}\r\n-                            </button>\r\n-                            \r\n-                            {/* This block will now correctly update when rewriteSuggestions[tooltip.index] changes */}\r\n-                            {rewriteSuggestions[tooltip.index] && (\r\n-                                <div className=\"mt-2 p-3 bg-gray-700 rounded-md\">\r\n-                                    <p className=\"text-sm text-white\">{rewriteSuggestions[tooltip.index]}</p>\r\n-                                </div>\r\n-                            )}\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-            )}\r\n-            {/* --- END MODIFICATION --- */}\r\n-\r\n-            <h3 className=\"text-xl font-semibold mb-4\">Highlighted Document</h3>\r\n-            <p className=\"text-sm text-gray-500 mb-4\">Click on a highlighted section for details and rewrite options.</p>\r\n-            <div className=\"border p-4 rounded-md bg-gray-50 leading-relaxed whitespace-pre-wrap\">\r\n-                {structuredText.map((item, index) => {\r\n-                    if (item.plagiarized) {\r\n+        <div className=\"relative\">\r\n+            <h3 className=\"text-xl font-semibold mb-4\">Detailed Report</h3>\r\n+            <p className=\"text-sm text-gray-500 mb-4\">Click on a highlighted sentence to see the source and suggest a rewrite.</p>\r\n+            <div className=\"p-6 border rounded-md bg-gray-50 whitespace-pre-wrap leading-relaxed\">\r\n+                {structuredText.map((segment, index) => {\r\n+                    if (segment.plagiarized) {\r\n+                        const className = segment.type === 'Direct Match'\r\n+                            ? 'highlight highlight-direct'\r\n+                            : 'highlight highlight-paraphrased';\r\n                         return (\r\n                             <span\r\n                                 key={index}\r\n-                                className={`highlight ${item.type === 'Direct Match' ? 'highlight-direct' : 'highlight-paraphrased'}`}\r\n-                                onClick={(e) => {\r\n-                                    e.stopPropagation();\r\n-                                    handleHighlightClick(e, item, index);\r\n-                                }}\r\n+                                className={className}\r\n+                                onClick={(e) => handleHighlightClick(e, segment, index)}\r\n                             >\r\n-                                {item.text}{' '}\r\n+                                {segment.text}\r\n                             </span>\r\n                         );\r\n-                    } else {\r\n-                        return <span key={index}>{item.text} </span>;\r\n                     }\r\n+                    return <span key={index}>{segment.text}</span>;\r\n                 })}\r\n             </div>\r\n+\r\n+            {/* Tooltip */}\r\n+            {tooltip.visible && (\r\n+                <div\r\n+                    className=\"tooltip-container\"\r\n+                    style={{\r\n+                        position: 'absolute',\r\n+                        left: `${tooltip.x}px`,\r\n+                        top: `${tooltip.y}px`,\r\n+                        transform: 'translate(-50%, -105%)', // Position above cursor\r\n+                        zIndex: 50,\r\n+                    }}\r\n+                >\r\n+                    <div className=\"tooltip visible w-80 p-4 bg-gray-800 text-white rounded-lg shadow-xl\">\r\n+                        <p className=\"text-sm font-semibold mb-2\">Plagiarism Details</p>\r\n+                        <p className=\"text-xs mb-1\">\r\n+                            <span className=\"font-bold\">Source:</span> {tooltip.content.source}\r\n+                        </p>\r\n+                        <p className=\"text-xs mb-3\">\r\n+                            <span className=\"font-bold\">Type:</span> {tooltip.content.type} ({tooltip.content.similarity}%)\r\n+                        </p>\r\n+                        <button\r\n+                            onClick={() => handleRewrite(tooltip.content.text, tooltip.index)}\r\n+                            disabled={rewritingIndex === tooltip.index}\r\n+                            className=\"text-sm font-medium text-indigo-400 hover:text-indigo-300 disabled:opacity-50 disabled:cursor-wait\"\r\n+                        >\r\n+                            {rewritingIndex === tooltip.index ? 'Generating...' : '✨ Suggest Rewrite'}\r\n+                        </button>\r\n+                        \r\n+                        {/* This will now update correctly */}\r\n+                        {rewriteSuggestions[tooltip.index] && (\r\n+                            <div className=\"mt-2 p-3 bg-gray-700 rounded-md\">\r\n+                                <p className=\"text-xs text-gray-200\">{rewriteSuggestions[tooltip.index]}</p>\r\n+                            </div>\r\n+                        )}\r\n+\r\n+                        <button\r\n+                            onClick={() => setTooltip({ ...tooltip, visible: false })}\r\n+                            className=\"absolute top-1 right-2 text-gray-400 hover:text-white\"\r\n+                        >\r\n+                            &times;\r\n+                        </button>\r\n+                    </div>\r\n+                </div>\r\n+            )}\r\n         </div>\r\n     );\r\n };\r\n \r\n"
                },
                {
                    "date": 1762601031240,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,32 +1,19 @@\n-import React, { useState, useEffect } from 'react';\r\n+import React, { useState } from 'react';\r\n import axios from 'axios';\r\n \r\n-// This component displays the colored-text report\r\n-const VisualReport = ({ structuredText, onRewrite }) => {\r\n+// This component ONLY renders the visual text and manages its own tooltip\r\n+const VisualReport = ({ structuredText }) => {\r\n     const [tooltip, setTooltip] = useState({\r\n         visible: false,\r\n-        content: null,\r\n+        item: null,\r\n+        index: null,\r\n         x: 0,\r\n         y: 0,\r\n-        index: null,\r\n     });\r\n     const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n     const [rewritingIndex, setRewritingIndex] = useState(null);\r\n \r\n-    // Hide tooltip when clicking anywhere else\r\n-    useEffect(() => {\r\n-        const handleClickOutside = (e) => {\r\n-            if (tooltip.visible && !e.target.closest('.tooltip-container')) {\r\n-                setTooltip({ ...tooltip, visible: false });\r\n-            }\r\n-        };\r\n-        document.addEventListener('mousedown', handleClickOutside);\r\n-        return () => {\r\n-            document.removeEventListener('mousedown', handleClickOutside);\r\n-        };\r\n-    }, [tooltip]);\r\n-\r\n     const getAuthToken = () => {\r\n         const user = JSON.parse(localStorage.getItem('user'));\r\n         return user ? user.token : null;\r\n     };\r\n@@ -54,92 +41,87 @@\n         }\r\n         setRewritingIndex(null);\r\n     };\r\n \r\n-    const handleHighlightClick = (e, segment, index) => {\r\n-        if (!segment.plagiarized) return;\r\n+    const handleHighlightClick = (e, item, index) => {\r\n+        if (!item.plagiarized) {\r\n+            setTooltip({ visible: false });\r\n+            return;\r\n+        }\r\n \r\n         const rect = e.target.getBoundingClientRect();\r\n-        \r\n         setTooltip({\r\n             visible: true,\r\n-            // We set the *data* for the tooltip here\r\n-            content: segment,\r\n+            item: item,\r\n             index: index,\r\n-            // Position tooltip above the click\r\n-            x: e.clientX,\r\n-            y: rect.top + window.scrollY,\r\n+            x: window.scrollX + rect.left + rect.width / 2,\r\n+            y: window.scrollY + rect.top,\r\n         });\r\n     };\r\n \r\n     return (\r\n-        <div className=\"relative\">\r\n-            <h3 className=\"text-xl font-semibold mb-4\">Detailed Report</h3>\r\n-            <p className=\"text-sm text-gray-500 mb-4\">Click on a highlighted sentence to see the source and suggest a rewrite.</p>\r\n-            <div className=\"p-6 border rounded-md bg-gray-50 whitespace-pre-wrap leading-relaxed\">\r\n-                {structuredText.map((segment, index) => {\r\n-                    if (segment.plagiarized) {\r\n-                        const className = segment.type === 'Direct Match'\r\n-                            ? 'highlight highlight-direct'\r\n-                            : 'highlight highlight-paraphrased';\r\n+        // This outer div now handles closing the tooltip\r\n+        <div onClick={() => setTooltip({ visible: false })}>\r\n+            {tooltip.visible && tooltip.item && (\r\n+                <div\r\n+                    className=\"tooltip visible\"\r\n+                    style={{ left: `${tooltip.x}px`, top: `${tooltip.y}px` }}\r\n+                    onClick={(e) => e.stopPropagation()} // Clicks inside tooltip don't close it\r\n+                >\r\n+                    <div className=\"p-2 text-sm\">\r\n+                        <p>\r\n+                            <span className=\"font-bold\">{tooltip.item.type}</span>\r\n+                            <span className={`ml-2 font-bold ${tooltip.item.type === 'Direct Match' ? 'text-red-300' : 'text-yellow-300'}`}>\r\n+                                ({tooltip.item.similarity}%)\r\n+                            </span>\r\n+                        </p>\r\n+                        <p className=\"mt-2 text-gray-300\">\r\n+                            <span className=\"font-semibold\">Source:</span> {tooltip.item.source}\r\n+                        </p>\r\n+                        <div className=\"mt-3\">\r\n+                            <button\r\n+                                onClick={(e) => {\r\n+                                    e.stopPropagation();\r\n+                                    handleRewrite(tooltip.item.text, tooltip.index);\r\n+                                }}\r\n+                                disabled={rewritingIndex === tooltip.index}\r\n+                                className=\"text-sm font-medium text-indigo-400 hover:text-indigo-300 disabled:opacity-50 disabled:cursor-wait\"\r\n+                            >\r\n+                                {rewritingIndex === tooltip.index ? 'Generating...' : '✨ Suggest Rewrite'}\r\n+                            </button>\r\n+                            \r\n+                            {rewriteSuggestions[tooltip.index] && (\r\n+                                <div className=\"mt-2 p-3 bg-gray-700 rounded-md\">\r\n+                                    <p className=\"text-sm text-white\">{rewriteSuggestions[tooltip.index]}</p>\r\n+                                </div>\r\n+                            )}\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+            )}\r\n+\r\n+            <h3 className=\"text-xl font-semibold mb-4\">Highlighted Document</h3>\r\n+            <p className=\"text-sm text-gray-500 mb-4\">Click on a highlighted section for details and rewrite options.</p>\r\n+            <div className=\"border p-4 rounded-md bg-gray-50 leading-relaxed whitespace-pre-wrap\">\r\n+                {structuredText.map((item, index) => {\r\n+                    if (item.plagiarized) {\r\n                         return (\r\n                             <span\r\n                                 key={index}\r\n-                                className={className}\r\n-                                onClick={(e) => handleHighlightClick(e, segment, index)}\r\n+                                className={`highlight ${item.type === 'Direct Match' ? 'highlight-direct' : 'highlight-paraphrased'}`}\r\n+                                onClick={(e) => {\r\n+                                    e.stopPropagation(); // Stop click from bubbling up\r\n+                                    handleHighlightClick(e, item, index);\r\n+                                }}\r\n                             >\r\n-                                {segment.text}\r\n+                                {item.text}{' '}\r\n                             </span>\r\n                         );\r\n+                    } else {\r\n+                        return <span key={index}>{item.text} </span>;\r\n                     }\r\n-                    return <span key={index}>{segment.text}</span>;\r\n                 })}\r\n             </div>\r\n-\r\n-            {/* Tooltip */}\r\n-            {tooltip.visible && (\r\n-                <div\r\n-                    className=\"tooltip-container\"\r\n-                    style={{\r\n-                        position: 'absolute',\r\n-                        left: `${tooltip.x}px`,\r\n-                        top: `${tooltip.y}px`,\r\n-                        transform: 'translate(-50%, -105%)', // Position above cursor\r\n-                        zIndex: 50,\r\n-                    }}\r\n-                >\r\n-                    <div className=\"tooltip visible w-80 p-4 bg-gray-800 text-white rounded-lg shadow-xl\">\r\n-                        <p className=\"text-sm font-semibold mb-2\">Plagiarism Details</p>\r\n-                        <p className=\"text-xs mb-1\">\r\n-                            <span className=\"font-bold\">Source:</span> {tooltip.content.source}\r\n-                        </p>\r\n-                        <p className=\"text-xs mb-3\">\r\n-                            <span className=\"font-bold\">Type:</span> {tooltip.content.type} ({tooltip.content.similarity}%)\r\n-                        </p>\r\n-                        <button\r\n-                            onClick={() => handleRewrite(tooltip.content.text, tooltip.index)}\r\n-                            disabled={rewritingIndex === tooltip.index}\r\n-                            className=\"text-sm font-medium text-indigo-400 hover:text-indigo-300 disabled:opacity-50 disabled:cursor-wait\"\r\n-                        >\r\n-                            {rewritingIndex === tooltip.index ? 'Generating...' : '✨ Suggest Rewrite'}\r\n-                        </button>\r\n-                        \r\n-                        {/* This will now update correctly */}\r\n-                        {rewriteSuggestions[tooltip.index] && (\r\n-                            <div className=\"mt-2 p-3 bg-gray-700 rounded-md\">\r\n-                                <p className=\"text-xs text-gray-200\">{rewriteSuggestions[tooltip.index]}</p>\r\n-                            </div>\r\n-                        )}\r\n-\r\n-                        <button\r\n-                            onClick={() => setTooltip({ ...tooltip, visible: false })}\r\n-                            className=\"absolute top-1 right-2 text-gray-400 hover:text-white\"\r\n-                        >\r\n-                            &times;\r\n-                        </button>\r\n-                    </div>\r\n-                </div>\r\n-            )}\r\n         </div>\r\n     );\r\n };\r\n \r\n"
                }
            ],
            "date": 1762593220606,
            "name": "Commit-0",
            "content": "import React, { useState } from 'react';\r\nimport axios from 'axios';\r\n\r\n// This component ONLY renders the visual text and manages its own tooltip\r\nconst VisualReport = ({ structuredText }) => {\r\n    const [tooltip, setTooltip] = useState({ visible: false, content: null, x: 0, y: 0 });\r\n    const [rewriteSuggestions, setRewriteSuggestions] = useState({});\r\n    const [rewritingIndex, setRewritingIndex] = useState(null);\r\n\r\n    const getAuthToken = () => {\r\n        const user = JSON.parse(localStorage.getItem('user'));\r\n        return user ? user.token : null;\r\n    };\r\n\r\n    const handleRewrite = async (sentence, index) => {\r\n        setRewritingIndex(index);\r\n        try {\r\n            const token = getAuthToken();\r\n            const response = await axios.post('http://localhost:5000/api/documents/rewrite', \r\n                { sentence },\r\n                { headers: { 'x-auth-token': token } }\r\n            );\r\n            \r\n            setRewriteSuggestions(prev => ({\r\n                ...prev,\r\n                [index]: response.data.rewritten_text\r\n            }));\r\n        } catch (error) {\r\n            console.error('Rewrite error:', error);\r\n            const errorMsg = error.response?.data?.error || 'Error generating suggestion.';\r\n            setRewriteSuggestions(prev => ({\r\n                ...prev,\r\n                [index]: errorMsg\r\n            }));\r\n        }\r\n        setRewritingIndex(null);\r\n    };\r\n\r\n    const handleHighlightClick = (e, item, index) => {\r\n        if (!item.plagiarized) {\r\n            setTooltip({ visible: false });\r\n            return;\r\n        }\r\n\r\n        const tooltipContent = (\r\n            <div className=\"p-2 text-sm\">\r\n                <p>\r\n                    <span className=\"font-bold\">{item.type}</span>\r\n                    <span className={`ml-2 font-bold ${item.type === 'Direct Match' ? 'text-red-300' : 'text-yellow-300'}`}>\r\n                        ({item.similarity}%)\r\n                    </span>\r\n                </p>\r\n                <p className=\"mt-2 text-gray-300\">\r\n                    <span className=\"font-semibold\">Source:</span> {item.source}\r\n                </p>\r\n                <div className=\"mt-3\">\r\n                    <button\r\n                        onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            handleRewrite(item.text, index);\r\n                        }}\r\n                        disabled={rewritingIndex === index}\r\n                        className=\"text-sm font-medium text-indigo-400 hover:text-indigo-300 disabled:opacity-50 disabled:cursor-wait\"\r\n                    >\r\n                        {rewritingIndex === index ? 'Generating...' : '✨ Suggest Rewrite'}\r\n                    </button>\r\n                    {rewriteSuggestions[index] && (\r\n                        <div className=\"mt-2 p-3 bg-gray-700 rounded-md\">\r\n                            <p className=\"text-sm text-white\">{rewriteSuggestions[index]}</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n\r\n        const rect = e.target.getBoundingClientRect();\r\n        setTooltip({\r\n            visible: true,\r\n            content: tooltipContent,\r\n            x: window.scrollX + rect.left + rect.width / 2,\r\n            y: window.scrollY + rect.top,\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div onClick={() => setTooltip({ visible: false })}>\r\n            {tooltip.visible && (\r\n                <div\r\n                    className=\"tooltip visible\"\r\n                    style={{ left: `${tooltip.x}px`, top: `${tooltip.y}px` }}\r\n                    onClick={(e) => e.stopPropagation()}\r\n                >\r\n                    {tooltip.content}\r\n                </div>\r\n            )}\r\n\r\n            <h3 className=\"text-xl font-semibold mb-4\">Highlighted Document</h3>\r\n            <p className=\"text-sm text-gray-500 mb-4\">Click on a highlighted section for details and rewrite options.</p>\r\n            <div className=\"border p-4 rounded-md bg-gray-50 leading-relaxed whitespace-pre-wrap\">\r\n                {structuredText.map((item, index) => {\r\n                    if (item.plagiarized) {\r\n                        return (\r\n                            <span\r\n                                key={index}\r\n                                className={`highlight ${item.type === 'Direct Match' ? 'highlight-direct' : 'highlight-paraphrased'}`}\r\n                                onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    handleHighlightClick(e, item, index);\r\n                                }}\r\n                            >\r\n                                {item.text}{' '}\r\n                            </span>\r\n                        );\r\n                    } else {\r\n                        return <span key={index}>{item.text} </span>;\r\n                    }\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VisualReport;"
        }
    ]
}