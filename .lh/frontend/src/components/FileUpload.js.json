{
    "sourceFile": "frontend/src/components/FileUpload.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1762593146654,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1762593146654,
            "name": "Commit-0",
            "content": "import React, { useState, useRef } from 'react';\r\nimport axios from 'axios';\r\n\r\n// This component now handles all upload logic\r\n// It takes a function prop 'onAnalysisComplete' to send data to the parent\r\nconst FileUpload = ({ onAnalysisStart, onAnalysisComplete, onAnalysisError }) => {\r\n    const [file, setFile] = useState(null);\r\n    const [message, setMessage] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const fileInputRef = useRef(null);\r\n\r\n    const getAuthToken = () => {\r\n        const user = JSON.parse(localStorage.getItem('user'));\r\n        return user ? user.token : null;\r\n    };\r\n\r\n    const onFileChange = e => {\r\n        setFile(e.target.files[0]);\r\n        setMessage('');\r\n        onAnalysisStart(); // Clear parent's old results\r\n    };\r\n\r\n    const onFormSubmit = async e => {\r\n        e.preventDefault();\r\n        setIsLoading(true);\r\n        setMessage('Uploading and analyzing...');\r\n\r\n        if (!file) {\r\n            setMessage('Please select a file first.');\r\n            setIsLoading(false);\r\n            onAnalysisError('Please select a file first.');\r\n            return;\r\n        }\r\n\r\n        const formData = new FormData();\r\n        formData.append('document', file);\r\n        const token = getAuthToken();\r\n\r\n        if (!token) {\r\n            setMessage('Authorization error. Please log in again.');\r\n            setIsLoading(false);\r\n            onAnalysisError('Authorization error. Please log in again.');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await axios.post('http://localhost:5000/api/documents/upload', formData, {\r\n                headers: {\r\n                    'Content-Type': 'multipart/form-data',\r\n                    'x-auth-token': token\r\n                }\r\n            });\r\n            // Pass the full result (and the file) up to the parent\r\n            onAnalysisComplete(response.data, file);\r\n            setMessage('Analysis complete.');\r\n        } catch (error) {\r\n            console.error('Upload error:', error.response?.data || error.message);\r\n            const errorMsg = 'Analysis failed: ' + (error.response?.data?.error || error.response?.data || 'Server error.');\r\n            setMessage(errorMsg);\r\n            onAnalysisError(errorMsg);\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={onFormSubmit} className=\"bg-white p-6 rounded-lg shadow-md mb-8\">\r\n            <h2 className=\"text-xl font-semibold mb-4\">Check a New Document</h2>\r\n            <div className=\"flex items-center space-x-4\">\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={() => fileInputRef.current.click()}\r\n                    className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 border border-gray-300\"\r\n                >\r\n                    Choose File\r\n                </button>\r\n                <span className=\"text-gray-500\">{file ? file.name : 'No file selected.'}</span>\r\n                <input\r\n                    type=\"file\"\r\n                    className=\"hidden\"\r\n                    onChange={onFileChange}\r\n                    ref={fileInputRef}\r\n                    accept=\".txt,.pdf,.doc,.docx\"\r\n                />\r\n            </div>\r\n            <p className=\"text-xs text-gray-400 mt-2\">Accepted formats: .txt, .pdf, .docx, .doc</p>\r\n            \r\n            <button\r\n                type=\"submit\"\r\n                disabled={isLoading || !file}\r\n                className=\"mt-4 w-full px-4 py-2 font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n                {isLoading ? 'Analyzing...' : 'Start Analysis'}\r\n            </button>\r\n            {message && <p className=\"mt-4 text-center text-gray-600\">{message}</p>}\r\n        </form>\r\n    );\r\n};\r\n\r\nexport default FileUpload;"
        }
    ]
}