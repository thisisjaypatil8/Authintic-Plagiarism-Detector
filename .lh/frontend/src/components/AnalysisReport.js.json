{
    "sourceFile": "frontend/src/components/AnalysisReport.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1762593304616,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762596306723,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,97 +1,163 @@\n import React from 'react';\r\n import jsPDF from 'jspdf';\r\n import autoTable from 'jspdf-autotable';\r\n-import VisualReport from './VisualReport'; // Import our new component\r\n+import VisualReport from './VisualReport'; // We're keeping this\r\n+import DoughnutChart from './DoughnutChart'; // Import our new chart\r\n \r\n-// This component ONLY displays the results.\r\n-// It receives the 'result' and 'file' objects as props.\r\n+// This component receives the full 'result' and 'file' objects as props\r\n const AnalysisReport = ({ result, file }) => {\r\n+  // Extract the new stats object from the result\r\n+  const { stats, overall_score, full_text_structured, flagged_sections, full_text } = result;\r\n \r\n-    const handleDownloadPDF = () => {\r\n-        if (!result) return;\r\n+  const handleDownloadPDF = () => {\r\n+    // This function remains unchanged\r\n+    const doc = new jsPDF();\r\n+    const user = JSON.parse(localStorage.getItem('user'));\r\n+    \r\n+    doc.setFont('helvetica', 'bold');\r\n+    doc.setFontSize(20);\r\n+    doc.text('Plagiarism Analysis Report', 105, 20, { align: 'center' });\r\n \r\n-        const doc = new jsPDF();\r\n-        const user = JSON.parse(localStorage.getItem('user'));\r\n-        \r\n-        doc.setFont('helvetica', 'bold');\r\n-        doc.setFontSize(20);\r\n-        doc.text('Plagiarism Analysis Report', 105, 20, { align: 'center' });\r\n+    doc.setFont('helvetica', 'normal');\r\n+    doc.setFontSize(12);\r\n+    doc.text(`Report for: ${user?.name || 'User'}`, 14, 35);\r\n+    doc.text(`Analyzed File: ${file?.name || 'N/A'}`, 14, 42);\r\n+    doc.text(`Date: ${new Date().toLocaleString()}`, 14, 49);\r\n \r\n-        doc.setFont('helvetica', 'normal');\r\n-        doc.setFontSize(12);\r\n-        doc.text(`Report for: ${user?.name || 'User'}`, 14, 35);\r\n-        doc.text(`Analyzed File: ${file?.name || 'N/A'}`, 14, 42);\r\n-        doc.text(`Date: ${new Date().toLocaleDateString()}`, 14, 49);\r\n+    doc.setFont('helvetica', 'bold');\r\n+    doc.text('Overall Similarity Score:', 14, 60);\r\n+    doc.setFont('helvetica', 'bold');\r\n+    doc.setTextColor(211, 47, 47); // Red color\r\n+    doc.setFontSize(16);\r\n+    doc.text(`${overall_score}%`, 75, 60);\r\n+    \r\n+    doc.setTextColor(0, 0, 0); // Reset color\r\n+    doc.setFontSize(12);\r\n \r\n-        doc.setFont('helvetica', 'bold');\r\n-        doc.text('Overall Similarity Score:', 14, 60);\r\n-        doc.setFont('helvetica', 'bold');\r\n-        doc.setTextColor(211, 47, 47); // Red color\r\n-        doc.setFontSize(16);\r\n-        doc.text(`${result.overall_score}%`, 75, 60);\r\n-        \r\n-        doc.setTextColor(0, 0, 0); // Reset color\r\n-        doc.setFontSize(12);\r\n+    doc.setFont('helvetica', 'bold');\r\n+    doc.text('Flagged Sections:', 14, 75);\r\n \r\n-        doc.setFont('helvetica', 'bold');\r\n-        doc.text('Flagged Sections:', 14, 75);\r\n+    const tableColumn = [\"Similarity\", \"Type\", \"Flagged Text\", \"Source\"];\r\n+    const tableRows = [];\r\n \r\n-        const tableColumn = [\"Similarity\", \"Type\", \"Flagged Text\", \"Source\"];\r\n-        const tableRows = [];\r\n+    flagged_sections.forEach(section => {\r\n+      const row = [\r\n+        `${section.similarity}%`,\r\n+        section.type,\r\n+        section.text,\r\n+        section.source\r\n+      ];\r\n+      tableRows.push(row);\r\n+    });\r\n \r\n-        result.flagged_sections.forEach(section => {\r\n-            const row = [\r\n-                `${section.similarity}%`,\r\n-                section.type,\r\n-                section.text,\r\n-                section.source\r\n-            ];\r\n-            tableRows.push(row);\r\n-        });\r\n+    autoTable(doc, {\r\n+      startY: 80,\r\n+      head: [tableColumn],\r\n+      body: tableRows,\r\n+      theme: 'striped',\r\n+      headStyles: { fillColor: [41, 128, 185] },\r\n+    });\r\n \r\n-        autoTable(doc, {\r\n-            startY: 80,\r\n-            head: [tableColumn],\r\n-            body: tableRows,\r\n-            theme: 'striped',\r\n-            headStyles: { fillColor: [41, 128, 185] }, // Blue header\r\n-        });\r\n+    doc.addPage();\r\n+    doc.setFont('helvetica', 'bold');\r\n+    doc.setFontSize(16);\r\n+    doc.text('Full Submitted Text', 14, 20);\r\n+    \r\n+    doc.setFont('helvetica', 'normal');\r\n+    doc.setFontSize(9);\r\n+    const splitText = doc.splitTextToSize(full_text, 180);\r\n+    doc.text(splitText, 14, 30);\r\n \r\n-        doc.addPage();\r\n-        doc.setFont('helvetica', 'bold');\r\n-        doc.setFontSize(16);\r\n-        doc.text('Full Submitted Text', 14, 20);\r\n+    doc.save(`Plagiarism_Report_${file?.name || 'analysis'}.pdf`);\r\n+  };\r\n+\r\n+  return (\r\n+    <div className=\"bg-white p-6 rounded-lg shadow-md\">\r\n+      <div className=\"flex justify-between items-center mb-6 border-b pb-6\">\r\n+        <h2 className=\"text-2xl font-semibold\">Analysis Report</h2>\r\n+        <button\r\n+          onClick={handleDownloadPDF}\r\n+          className=\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700\"\r\n+        >\r\n+          Download Report (PDF)\r\n+        </button>\r\n+      </div>\r\n+      \r\n+      {/* --- NEW VISUAL SUMMARY SECTION --- */}\r\n+      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n         \r\n-        doc.setFont('helvetica', 'normal');\r\n-        doc.setFontSize(9);\r\n-        const splitText = doc.splitTextToSize(result.full_text, 180);\r\n-        doc.text(splitText, 14, 30);\r\n+        {/* Chart Section */}\r\n+        <div className=\"md:col-span-1 flex flex-col items-center justify-center\">\r\n+          {/* Relative container to center the text */}\r\n+          <div className=\"relative w-48 h-48\">\r\n+            <DoughnutChart \r\n+              direct={stats.direct_percent}\r\n+              paraphrased={stats.paraphrased_percent}\r\n+              original={stats.original_percent}\r\n+            />\r\n+            {/* Absolute centered text */}\r\n+            <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n+              <span className=\"text-4xl font-bold text-red-600\">{overall_score}%</span>\r\n+              <span className=\"text-sm text-gray-500\">Similarity</span>\r\n+            </div>\r\n+          </div>\r\n+          \r\n+          {/* Legend */}\r\n+          <div className=\"mt-4 space-y-2 text-sm w-full max-w-xs\">\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"flex items-center\">\r\n+                <span className=\"w-3 h-3 rounded-full bg-green-500 mr-2\"></span>\r\n+                Original\r\n+              </span>\r\n+              <span className=\"font-medium\">{stats.original_percent.toFixed(1)}%</span>\r\n+            </div>\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"flex items-center\">\r\n+                <span className=\"w-3 h-3 rounded-full bg-yellow-500 mr-2\"></span>\r\n+                Paraphrased\r\n+              </span>\r\n+              <span className=\"font-medium\">{stats.paraphrased_percent.toFixed(1)}%</span>\r\n+            </div>\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"flex items-center\">\r\n+                <span className=\"w-3 h-3 rounded-full bg-red-500 mr-2\"></span>\r\n+                Direct Match\r\n+              </span>\r\n+              <span className=\"font-medium\">{stats.direct_percent.toFixed(1)}%</span>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n \r\n-        doc.save(`Plagiarism_Report_${file?.name || 'analysis'}.pdf`);\r\n-    };\r\n-\r\n-    return (\r\n-        <div className=\"bg-white p-6 rounded-lg shadow-md\">\r\n-            <div className=\"flex justify-between items-center mb-4\">\r\n-                <h2 className=\"text-2xl font-semibold\">Analysis Report</h2>\r\n-                <button\r\n-                    onClick={handleDownloadPDF}\r\n-                    className=\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700\"\r\n-                >\r\n-                    Download Report (PDF)\r\n-                </button>\r\n+        {/* Text Stats Section */}\r\n+        <div className=\"md:col-span-2 bg-gray-50 p-6 rounded-lg\">\r\n+          <h3 className=\"text-xl font-semibold mb-4\">Summary</h3>\r\n+          <div className=\"space-y-3\">\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"text-gray-600\">Total Sentences:</span>\r\n+              <span className=\"font-bold text-gray-800\">{stats.total_sentences}</span>\r\n             </div>\r\n-            <div className=\"mb-6 border-b pb-4\">\r\n-                <span className=\"text-gray-600 font-medium\">Overall Similarity Score:</span>\r\n-                <span className=\"ml-2 text-3xl font-bold text-red-600\">{result.overall_score}%</span>\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"text-gray-600\">Original Sentences:</span>\r\n+              <span className=\"font-bold text-green-600\">{stats.original_count}</span>\r\n             </div>\r\n-            \r\n-            {/* Render the new VisualReport component */}\r\n-            {result.full_text_structured && (\r\n-                <VisualReport structuredText={result.full_text_structured} />\r\n-            )}\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"text-gray-600\">Paraphrased Sentences:</span>\r\n+              <span className=\"font-bold text-yellow-600\">{stats.paraphrased_count}</span>\r\n+            </div>\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"text-gray-600\">Direct Match Sentences:</span>\r\n+              <span className=\"font-bold text-red-600\">{stats.direct_count}</span>\r\n+            </div>\r\n+          </div>\r\n         </div>\r\n-    );\r\n+      </div>\r\n+      \r\n+      {/* Visual Report (this is our existing component) */}\r\n+      {full_text_structured && (\r\n+        <VisualReport structuredText={full_text_structured} />\r\n+      )}\r\n+    </div>\r\n+  );\r\n };\r\n \r\n export default AnalysisReport;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1762599541481,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,162 +1,240 @@\n-import React from 'react';\r\n+import React, { useRef } from 'react';\r\n import jsPDF from 'jspdf';\r\n import autoTable from 'jspdf-autotable';\r\n-import VisualReport from './VisualReport'; // We're keeping this\r\n-import DoughnutChart from './DoughnutChart'; // Import our new chart\r\n+import DoughnutChart from './DoughnutChart';\r\n+import VisualReport from './VisualReport';\r\n \r\n-// This component receives the full 'result' and 'file' objects as props\r\n-const AnalysisReport = ({ result, file }) => {\r\n-  // Extract the new stats object from the result\r\n-  const { stats, overall_score, full_text_structured, flagged_sections, full_text } = result;\r\n+const AnalysisReport = ({ analysisResult, onRewrite }) => {\r\n+  // 1. Create a ref to hold the chart instance\r\n+  const chartRef = useRef(null);\r\n \r\n+  if (!analysisResult) {\r\n+    return null;\r\n+  }\r\n+\r\n+  const {\r\n+    overall_score,\r\n+    stats,\r\n+    flagged_sections,\r\n+    full_text_structured,\r\n+  } = analysisResult;\r\n+\r\n+  // --- NEW PDF DOWNLOAD LOGIC ---\r\n   const handleDownloadPDF = () => {\r\n-    // This function remains unchanged\r\n+    if (!analysisResult) return;\r\n+\r\n     const doc = new jsPDF();\r\n     const user = JSON.parse(localStorage.getItem('user'));\r\n-    \r\n+    const page = {\r\n+      width: doc.internal.pageSize.getWidth(),\r\n+      height: doc.internal.pageSize.getHeight(),\r\n+    };\r\n+    const margin = { top: 20, right: 14, bottom: 20, left: 14 };\r\n+\r\n+    // --- PAGE 1: SUMMARY & CHART ---\r\n+\r\n+    // 1. Title\r\n     doc.setFont('helvetica', 'bold');\r\n     doc.setFontSize(20);\r\n-    doc.text('Plagiarism Analysis Report', 105, 20, { align: 'center' });\r\n+    doc.text('Plagiarism Analysis Report', page.width / 2, margin.top, {\r\n+      align: 'center',\r\n+    });\r\n \r\n+    // 2. User Info\r\n     doc.setFont('helvetica', 'normal');\r\n     doc.setFontSize(12);\r\n-    doc.text(`Report for: ${user?.name || 'User'}`, 14, 35);\r\n-    doc.text(`Analyzed File: ${file?.name || 'N/A'}`, 14, 42);\r\n-    doc.text(`Date: ${new Date().toLocaleString()}`, 14, 49);\r\n+    doc.text(`Report for: ${user?.name || 'User'}`, margin.left, margin.top + 20);\r\n \r\n+    // 3. Overall Score\r\n     doc.setFont('helvetica', 'bold');\r\n-    doc.text('Overall Similarity Score:', 14, 60);\r\n+    doc.text('Overall Similarity Score:', margin.left, margin.top + 35);\r\n     doc.setFont('helvetica', 'bold');\r\n     doc.setTextColor(211, 47, 47); // Red color\r\n     doc.setFontSize(16);\r\n-    doc.text(`${overall_score}%`, 75, 60);\r\n+    doc.text(`${overall_score}%`, 75, margin.top + 35);\r\n+    doc.setTextColor(0, 0, 0); // Reset color\r\n+\r\n+    // 4. Add Chart Image\r\n+    if (chartRef.current) {\r\n+      const chartImage = chartRef.current.toBase64Image();\r\n+      // (Image, Format, X, Y, Width, Height)\r\n+      doc.addImage(chartImage, 'PNG', page.width / 2 - 40, margin.top + 45, 80, 80);\r\n+    }\r\n     \r\n-    doc.setTextColor(0, 0, 0); // Reset color\r\n+    // 5. Add Stats Summary Table\r\n+    autoTable(doc, {\r\n+      startY: margin.top + 135,\r\n+      head: [['Category', 'Sentences', 'Percentage']],\r\n+      body: [\r\n+        ['Original', stats.original_count, `${stats.original_percent.toFixed(2)}%`],\r\n+        ['Paraphrased', stats.paraphrased_count, `${stats.paraphrased_percent.toFixed(2)}%`],\r\n+        ['Direct Match', stats.direct_count, `${stats.direct_percent.toFixed(2)}%`],\r\n+        ['Total Sentences', stats.total_sentences, '100.00%'],\r\n+      ],\r\n+      headStyles: { fillColor: [41, 128, 185] }, // Blue header\r\n+      foot: [['Total Plagiarized', stats.direct_count + stats.paraphrased_count, `${(100 - stats.original_percent).toFixed(2)}%`]],\r\n+      footStyles: { fillColor: [231, 76, 60] }, // Red footer\r\n+      theme: 'striped',\r\n+    });\r\n+\r\n+    // 6. Add Flagged Sections Table\r\n+    // The table might be long, so we get the 'finalY' from the last table\r\n+    const lastTableY = doc.lastAutoTable.finalY;\r\n     doc.setFontSize(12);\r\n-\r\n     doc.setFont('helvetica', 'bold');\r\n-    doc.text('Flagged Sections:', 14, 75);\r\n+    doc.text('Flagged Sections Details:', margin.left, lastTableY + 15);\r\n \r\n-    const tableColumn = [\"Similarity\", \"Type\", \"Flagged Text\", \"Source\"];\r\n-    const tableRows = [];\r\n-\r\n-    flagged_sections.forEach(section => {\r\n-      const row = [\r\n+    autoTable(doc, {\r\n+      startY: lastTableY + 20,\r\n+      head: [['Similarity', 'Type', 'Flagged Text', 'Source']],\r\n+      body: flagged_sections.map((section) => [\r\n         `${section.similarity}%`,\r\n         section.type,\r\n         section.text,\r\n-        section.source\r\n-      ];\r\n-      tableRows.push(row);\r\n-    });\r\n-\r\n-    autoTable(doc, {\r\n-      startY: 80,\r\n-      head: [tableColumn],\r\n-      body: tableRows,\r\n+        section.source,\r\n+      ]),\r\n+      headStyles: { fillColor: [41, 128, 185] },\r\n       theme: 'striped',\r\n-      headStyles: { fillColor: [41, 128, 185] },\r\n     });\r\n \r\n+    // --- NEW PAGE: FULL TEXT APPENDIX ---\r\n     doc.addPage();\r\n     doc.setFont('helvetica', 'bold');\r\n     doc.setFontSize(16);\r\n-    doc.text('Full Submitted Text', 14, 20);\r\n-    \r\n+    doc.text('Appendix: Full Submitted Text (with Highlighting)', margin.left, margin.top);\r\n+\r\n+    // --- CUSTOM TEXT RENDERER WITH HIGHLIGHTING & PAGINATION ---\r\n     doc.setFont('helvetica', 'normal');\r\n-    doc.setFontSize(9);\r\n-    const splitText = doc.splitTextToSize(full_text, 180);\r\n-    doc.text(splitText, 14, 30);\r\n+    const fontSize = 10;\r\n+    const lineHeight = fontSize * 0.35 * 1.5; // 10pt font, 1.5 line spacing\r\n+    doc.setFontSize(fontSize);\r\n \r\n-    doc.save(`Plagiarism_Report_${file?.name || 'analysis'}.pdf`);\r\n+    let currentX = margin.left;\r\n+    let currentY = margin.top + 15; // Start below appendix title\r\n+    const pageHeight = page.height - margin.bottom;\r\n+    const pageWidth = page.width - margin.right;\r\n+\r\n+    // Helper function for new pages\r\n+    const addNewPage = () => {\r\n+      doc.addPage();\r\n+      currentY = margin.top;\r\n+      doc.setFontSize(fontSize);\r\n+    };\r\n+    \r\n+    // Iterate over each structured sentence block\r\n+    full_text_structured.forEach((segment) => {\r\n+      const words = segment.text.split(' ');\r\n+      const spaceWidth = doc.getStringUnitWidth(' ') * fontSize / doc.internal.scaleFactor;\r\n+      \r\n+      // Set highlight color for this block\r\n+      let highlightColor = null;\r\n+      if (segment.plagiarized) {\r\n+        highlightColor = segment.type === 'Direct Match' ? [255, 99, 132] : [255, 206, 86]; // Red or Yellow\r\n+      }\r\n+\r\n+      words.forEach((word) => {\r\n+        const wordWidth = doc.getStringUnitWidth(word) * fontSize / doc.internal.scaleFactor;\r\n+\r\n+        // Check if word fits on the current line\r\n+        if (currentX + wordWidth > pageWidth) {\r\n+          // Word doesn't fit, move to next line\r\n+          currentX = margin.left;\r\n+          currentY += lineHeight;\r\n+        }\r\n+\r\n+        // Check if line fits on the current page\r\n+        if (currentY + lineHeight > pageHeight) {\r\n+          // Line doesn't fit, add a new page\r\n+          addNewPage();\r\n+        }\r\n+\r\n+        // 1. Draw highlight (if needed)\r\n+        if (highlightColor) {\r\n+          doc.setFillColor(highlightColor[0], highlightColor[1], highlightColor[2]);\r\n+          // (X, Y, Width, Height, Style: 'F' = Fill)\r\n+          doc.rect(currentX, currentY - (lineHeight * 0.7), wordWidth, lineHeight, 'F');\r\n+        }\r\n+\r\n+        // 2. Draw text\r\n+        doc.setTextColor(0, 0, 0); // Black text\r\n+        doc.text(word, currentX, currentY);\r\n+\r\n+        // 3. Advance X position\r\n+        currentX += wordWidth + spaceWidth;\r\n+      });\r\n+      \r\n+      // Add a space after each segment (which is a sentence)\r\n+      currentX += spaceWidth;\r\n+    });\r\n+\r\n+    // 7. Save\r\n+    doc.save(`Plagiarism_Report.pdf`);\r\n   };\r\n \r\n   return (\r\n-    <div className=\"bg-white p-6 rounded-lg shadow-md\">\r\n-      <div className=\"flex justify-between items-center mb-6 border-b pb-6\">\r\n-        <h2 className=\"text-2xl font-semibold\">Analysis Report</h2>\r\n+    <div className=\"bg-white p-6 rounded-lg shadow-md mt-8\">\r\n+      <div className=\"flex justify-between items-center mb-6 border-b pb-4\">\r\n+        <div>\r\n+          <h2 className=\"text-2xl font-semibold\">Analysis Report</h2>\r\n+          <span className=\"text-gray-600 font-medium\">Overall Similarity Score:</span>\r\n+          <span className=\"ml-2 text-3xl font-bold text-red-600\">\r\n+            {overall_score}%\r\n+          </span>\r\n+        </div>\r\n         <button\r\n           onClick={handleDownloadPDF}\r\n-          className=\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700\"\r\n+          className=\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50\"\r\n         >\r\n           Download Report (PDF)\r\n         </button>\r\n       </div>\r\n-      \r\n-      {/* --- NEW VISUAL SUMMARY SECTION --- */}\r\n-      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n-        \r\n-        {/* Chart Section */}\r\n-        <div className=\"md:col-span-1 flex flex-col items-center justify-center\">\r\n-          {/* Relative container to center the text */}\r\n-          <div className=\"relative w-48 h-48\">\r\n-            <DoughnutChart \r\n-              direct={stats.direct_percent}\r\n-              paraphrased={stats.paraphrased_percent}\r\n-              original={stats.original_percent}\r\n-            />\r\n-            {/* Absolute centered text */}\r\n-            <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n-              <span className=\"text-4xl font-bold text-red-600\">{overall_score}%</span>\r\n-              <span className=\"text-sm text-gray-500\">Similarity</span>\r\n-            </div>\r\n-          </div>\r\n-          \r\n-          {/* Legend */}\r\n-          <div className=\"mt-4 space-y-2 text-sm w-full max-w-xs\">\r\n-            <div className=\"flex justify-between\">\r\n+\r\n+      {/* Stats and Chart */}\r\n+      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 items-center\">\r\n+        {/* Chart */}\r\n+        <div className=\"h-64\">\r\n+          <DoughnutChart ref={chartRef} stats={stats} />\r\n+        </div>\r\n+\r\n+        {/* Stats Table */}\r\n+        <div>\r\n+          <h3 className=\"text-lg font-semibold mb-3\">Analysis Breakdown</h3>\r\n+          <ul className=\"space-y-2\">\r\n+            <li className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\r\n               <span className=\"flex items-center\">\r\n                 <span className=\"w-3 h-3 rounded-full bg-green-500 mr-2\"></span>\r\n                 Original\r\n               </span>\r\n-              <span className=\"font-medium\">{stats.original_percent.toFixed(1)}%</span>\r\n-            </div>\r\n-            <div className=\"flex justify-between\">\r\n+              <span className=\"font-medium\">{stats.original_count} ({stats.original_percent.toFixed(1)}%)</span>\r\n+            </li>\r\n+            <li className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\r\n               <span className=\"flex items-center\">\r\n                 <span className=\"w-3 h-3 rounded-full bg-yellow-500 mr-2\"></span>\r\n                 Paraphrased\r\n               </span>\r\n-              <span className=\"font-medium\">{stats.paraphrased_percent.toFixed(1)}%</span>\r\n-            </div>\r\n-            <div className=\"flex justify-between\">\r\n+              <span className=\"font-medium\">{stats.paraphrased_count} ({stats.paraphrased_percent.toFixed(1)}%)</span>\r\n+            </li>\r\n+            <li className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\r\n               <span className=\"flex items-center\">\r\n                 <span className=\"w-3 h-3 rounded-full bg-red-500 mr-2\"></span>\r\n                 Direct Match\r\n               </span>\r\n-              <span className=\"font-medium\">{stats.direct_percent.toFixed(1)}%</span>\r\n-            </div>\r\n-          </div>\r\n+              <span className=\"font-medium\">{stats.direct_count} ({stats.direct_percent.toFixed(1)}%)</span>\r\n+            </li>\r\n+            <li className=\"flex justify-between items-center p-2 border-t mt-2\">\r\n+              <span className=\"font-semibold\">Total Sentences</span>\r\n+              <span className=\"font-semibold\">{stats.total_sentences}</span>\r\n+            </li>\r\n+          </ul>\r\n         </div>\r\n+      </div>\r\n \r\n-        {/* Text Stats Section */}\r\n-        <div className=\"md:col-span-2 bg-gray-50 p-6 rounded-lg\">\r\n-          <h3 className=\"text-xl font-semibold mb-4\">Summary</h3>\r\n-          <div className=\"space-y-3\">\r\n-            <div className=\"flex justify-between\">\r\n-              <span className=\"text-gray-600\">Total Sentences:</span>\r\n-              <span className=\"font-bold text-gray-800\">{stats.total_sentences}</span>\r\n-            </div>\r\n-            <div className=\"flex justify-between\">\r\n-              <span className=\"text-gray-600\">Original Sentences:</span>\r\n-              <span className=\"font-bold text-green-600\">{stats.original_count}</span>\r\n-            </div>\r\n-            <div className=\"flex justify-between\">\r\n-              <span className=\"text-gray-600\">Paraphrased Sentences:</span>\r\n-              <span className=\"font-bold text-yellow-600\">{stats.paraphrased_count}</span>\r\n-            </div>\r\n-            <div className=\"flex justify-between\">\r\n-              <span className=\"text-gray-600\">Direct Match Sentences:</span>\r\n-              <span className=\"font-bold text-red-600\">{stats.direct_count}</span>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-      \r\n-      {/* Visual Report (this is our existing component) */}\r\n-      {full_text_structured && (\r\n-        <VisualReport structuredText={full_text_structured} />\r\n-      )}\r\n+      {/* Visual Report */}\r\n+      <VisualReport\r\n+        structuredText={full_text_structured}\r\n+        onRewrite={onRewrite}\r\n+      />\r\n     </div>\r\n   );\r\n };\r\n \r\n"
                },
                {
                    "date": 1762599955138,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,240 +1,162 @@\n-import React, { useRef } from 'react';\r\n+import React from 'react';\r\n import jsPDF from 'jspdf';\r\n import autoTable from 'jspdf-autotable';\r\n-import DoughnutChart from './DoughnutChart';\r\n-import VisualReport from './VisualReport';\r\n+import VisualReport from './VisualReport'; // We're keeping this\r\n+import DoughnutChart from './DoughnutChart'; // Import our new chart\r\n \r\n-const AnalysisReport = ({ analysisResult, onRewrite }) => {\r\n-  // 1. Create a ref to hold the chart instance\r\n-  const chartRef = useRef(null);\r\n+// This component receives the full 'result' and 'file' objects as props\r\n+const AnalysisReport = ({ result, file }) => {\r\n+  // Extract the new stats object from the result\r\n+  const { stats, overall_score, full_text_structured, flagged_sections, full_text } = result;\r\n \r\n-  if (!analysisResult) {\r\n-    return null;\r\n-  }\r\n-\r\n-  const {\r\n-    overall_score,\r\n-    stats,\r\n-    flagged_sections,\r\n-    full_text_structured,\r\n-  } = analysisResult;\r\n-\r\n-  // --- NEW PDF DOWNLOAD LOGIC ---\r\n   const handleDownloadPDF = () => {\r\n-    if (!analysisResult) return;\r\n-\r\n+    // This function remains unchanged\r\n     const doc = new jsPDF();\r\n     const user = JSON.parse(localStorage.getItem('user'));\r\n-    const page = {\r\n-      width: doc.internal.pageSize.getWidth(),\r\n-      height: doc.internal.pageSize.getHeight(),\r\n-    };\r\n-    const margin = { top: 20, right: 14, bottom: 20, left: 14 };\r\n-\r\n-    // --- PAGE 1: SUMMARY & CHART ---\r\n-\r\n-    // 1. Title\r\n+    \r\n     doc.setFont('helvetica', 'bold');\r\n     doc.setFontSize(20);\r\n-    doc.text('Plagiarism Analysis Report', page.width / 2, margin.top, {\r\n-      align: 'center',\r\n-    });\r\n+    doc.text('Plagiarism Analysis Report', 105, 20, { align: 'center' });\r\n \r\n-    // 2. User Info\r\n     doc.setFont('helvetica', 'normal');\r\n     doc.setFontSize(12);\r\n-    doc.text(`Report for: ${user?.name || 'User'}`, margin.left, margin.top + 20);\r\n+    doc.text(`Report for: ${user?.name || 'User'}`, 14, 35);\r\n+    doc.text(`Analyzed File: ${file?.name || 'N/A'}`, 14, 42);\r\n+    doc.text(`Date: ${new Date().toLocaleString()}`, 14, 49);\r\n \r\n-    // 3. Overall Score\r\n     doc.setFont('helvetica', 'bold');\r\n-    doc.text('Overall Similarity Score:', margin.left, margin.top + 35);\r\n+    doc.text('Overall Similarity Score:', 14, 60);\r\n     doc.setFont('helvetica', 'bold');\r\n     doc.setTextColor(211, 47, 47); // Red color\r\n     doc.setFontSize(16);\r\n-    doc.text(`${overall_score}%`, 75, margin.top + 35);\r\n+    doc.text(`${overall_score}%`, 75, 60);\r\n+    \r\n     doc.setTextColor(0, 0, 0); // Reset color\r\n+    doc.setFontSize(12);\r\n \r\n-    // 4. Add Chart Image\r\n-    if (chartRef.current) {\r\n-      const chartImage = chartRef.current.toBase64Image();\r\n-      // (Image, Format, X, Y, Width, Height)\r\n-      doc.addImage(chartImage, 'PNG', page.width / 2 - 40, margin.top + 45, 80, 80);\r\n-    }\r\n-    \r\n-    // 5. Add Stats Summary Table\r\n-    autoTable(doc, {\r\n-      startY: margin.top + 135,\r\n-      head: [['Category', 'Sentences', 'Percentage']],\r\n-      body: [\r\n-        ['Original', stats.original_count, `${stats.original_percent.toFixed(2)}%`],\r\n-        ['Paraphrased', stats.paraphrased_count, `${stats.paraphrased_percent.toFixed(2)}%`],\r\n-        ['Direct Match', stats.direct_count, `${stats.direct_percent.toFixed(2)}%`],\r\n-        ['Total Sentences', stats.total_sentences, '100.00%'],\r\n-      ],\r\n-      headStyles: { fillColor: [41, 128, 185] }, // Blue header\r\n-      foot: [['Total Plagiarized', stats.direct_count + stats.paraphrased_count, `${(100 - stats.original_percent).toFixed(2)}%`]],\r\n-      footStyles: { fillColor: [231, 76, 60] }, // Red footer\r\n-      theme: 'striped',\r\n-    });\r\n-\r\n-    // 6. Add Flagged Sections Table\r\n-    // The table might be long, so we get the 'finalY' from the last table\r\n-    const lastTableY = doc.lastAutoTable.finalY;\r\n-    doc.setFontSize(12);\r\n     doc.setFont('helvetica', 'bold');\r\n-    doc.text('Flagged Sections Details:', margin.left, lastTableY + 15);\r\n+    doc.text('Flagged Sections:', 14, 75);\r\n \r\n-    autoTable(doc, {\r\n-      startY: lastTableY + 20,\r\n-      head: [['Similarity', 'Type', 'Flagged Text', 'Source']],\r\n-      body: flagged_sections.map((section) => [\r\n+    const tableColumn = [\"Similarity\", \"Type\", \"Flagged Text\", \"Source\"];\r\n+    const tableRows = [];\r\n+\r\n+    flagged_sections.forEach(section => {\r\n+      const row = [\r\n         `${section.similarity}%`,\r\n         section.type,\r\n         section.text,\r\n-        section.source,\r\n-      ]),\r\n+        section.source\r\n+      ];\r\n+      tableRows.push(row);\r\n+    });\r\n+\r\n+    autoTable(doc, {\r\n+      startY: 80,\r\n+      head: [tableColumn],\r\n+      body: tableRows,\r\n+      theme: 'striped',\r\n       headStyles: { fillColor: [41, 128, 185] },\r\n-      theme: 'striped',\r\n     });\r\n \r\n-    // --- NEW PAGE: FULL TEXT APPENDIX ---\r\n     doc.addPage();\r\n     doc.setFont('helvetica', 'bold');\r\n     doc.setFontSize(16);\r\n-    doc.text('Appendix: Full Submitted Text (with Highlighting)', margin.left, margin.top);\r\n-\r\n-    // --- CUSTOM TEXT RENDERER WITH HIGHLIGHTING & PAGINATION ---\r\n+    doc.text('Full Submitted Text', 14, 20);\r\n+    \r\n     doc.setFont('helvetica', 'normal');\r\n-    const fontSize = 10;\r\n-    const lineHeight = fontSize * 0.35 * 1.5; // 10pt font, 1.5 line spacing\r\n-    doc.setFontSize(fontSize);\r\n+    doc.setFontSize(9);\r\n+    const splitText = doc.splitTextToSize(full_text, 180);\r\n+    doc.text(splitText, 14, 30);\r\n \r\n-    let currentX = margin.left;\r\n-    let currentY = margin.top + 15; // Start below appendix title\r\n-    const pageHeight = page.height - margin.bottom;\r\n-    const pageWidth = page.width - margin.right;\r\n-\r\n-    // Helper function for new pages\r\n-    const addNewPage = () => {\r\n-      doc.addPage();\r\n-      currentY = margin.top;\r\n-      doc.setFontSize(fontSize);\r\n-    };\r\n-    \r\n-    // Iterate over each structured sentence block\r\n-    full_text_structured.forEach((segment) => {\r\n-      const words = segment.text.split(' ');\r\n-      const spaceWidth = doc.getStringUnitWidth(' ') * fontSize / doc.internal.scaleFactor;\r\n-      \r\n-      // Set highlight color for this block\r\n-      let highlightColor = null;\r\n-      if (segment.plagiarized) {\r\n-        highlightColor = segment.type === 'Direct Match' ? [255, 99, 132] : [255, 206, 86]; // Red or Yellow\r\n-      }\r\n-\r\n-      words.forEach((word) => {\r\n-        const wordWidth = doc.getStringUnitWidth(word) * fontSize / doc.internal.scaleFactor;\r\n-\r\n-        // Check if word fits on the current line\r\n-        if (currentX + wordWidth > pageWidth) {\r\n-          // Word doesn't fit, move to next line\r\n-          currentX = margin.left;\r\n-          currentY += lineHeight;\r\n-        }\r\n-\r\n-        // Check if line fits on the current page\r\n-        if (currentY + lineHeight > pageHeight) {\r\n-          // Line doesn't fit, add a new page\r\n-          addNewPage();\r\n-        }\r\n-\r\n-        // 1. Draw highlight (if needed)\r\n-        if (highlightColor) {\r\n-          doc.setFillColor(highlightColor[0], highlightColor[1], highlightColor[2]);\r\n-          // (X, Y, Width, Height, Style: 'F' = Fill)\r\n-          doc.rect(currentX, currentY - (lineHeight * 0.7), wordWidth, lineHeight, 'F');\r\n-        }\r\n-\r\n-        // 2. Draw text\r\n-        doc.setTextColor(0, 0, 0); // Black text\r\n-        doc.text(word, currentX, currentY);\r\n-\r\n-        // 3. Advance X position\r\n-        currentX += wordWidth + spaceWidth;\r\n-      });\r\n-      \r\n-      // Add a space after each segment (which is a sentence)\r\n-      currentX += spaceWidth;\r\n-    });\r\n-\r\n-    // 7. Save\r\n-    doc.save(`Plagiarism_Report.pdf`);\r\n+    doc.save(`Plagiarism_Report_${file?.name || 'analysis'}.pdf`);\r\n   };\r\n \r\n   return (\r\n-    <div className=\"bg-white p-6 rounded-lg shadow-md mt-8\">\r\n-      <div className=\"flex justify-between items-center mb-6 border-b pb-4\">\r\n-        <div>\r\n-          <h2 className=\"text-2xl font-semibold\">Analysis Report</h2>\r\n-          <span className=\"text-gray-600 font-medium\">Overall Similarity Score:</span>\r\n-          <span className=\"ml-2 text-3xl font-bold text-red-600\">\r\n-            {overall_score}%\r\n-          </span>\r\n-        </div>\r\n+    <div className=\"bg-white p-6 rounded-lg shadow-md\">\r\n+      <div className=\"flex justify-between items-center mb-6 border-b pb-6\">\r\n+        <h2 className=\"text-2xl font-semibold\">Analysis Report</h2>\r\n         <button\r\n           onClick={handleDownloadPDF}\r\n-          className=\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50\"\r\n+          className=\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700\"\r\n         >\r\n           Download Report (PDF)\r\n         </button>\r\n       </div>\r\n-\r\n-      {/* Stats and Chart */}\r\n-      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 items-center\">\r\n-        {/* Chart */}\r\n-        <div className=\"h-64\">\r\n-          <DoughnutChart ref={chartRef} stats={stats} />\r\n-        </div>\r\n-\r\n-        {/* Stats Table */}\r\n-        <div>\r\n-          <h3 className=\"text-lg font-semibold mb-3\">Analysis Breakdown</h3>\r\n-          <ul className=\"space-y-2\">\r\n-            <li className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\r\n+      \r\n+      {/* --- NEW VISUAL SUMMARY SECTION --- */}\r\n+      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n+        \r\n+        {/* Chart Section */}\r\n+        <div className=\"md:col-span-1 flex flex-col items-center justify-center\">\r\n+          {/* Relative container to center the text */}\r\n+          <div className=\"relative w-48 h-48\">\r\n+            <DoughnutChart \r\n+              direct={stats.direct_percent}\r\n+              paraphrased={stats.paraphrased_percent}\r\n+              original={stats.original_percent}\r\n+            />\r\n+            {/* Absolute centered text */}\r\n+            <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n+              <span className=\"text-4xl font-bold text-red-600\">{overall_score}%</span>\r\n+              <span className=\"text-sm text-gray-500\">Similarity</span>\r\n+            </div>\r\n+          </div>\r\n+          \r\n+          {/* Legend */}\r\n+          <div className=\"mt-4 space-y-2 text-sm w-full max-w-xs\">\r\n+            <div className=\"flex justify-between\">\r\n               <span className=\"flex items-center\">\r\n                 <span className=\"w-3 h-3 rounded-full bg-green-500 mr-2\"></span>\r\n                 Original\r\n               </span>\r\n-              <span className=\"font-medium\">{stats.original_count} ({stats.original_percent.toFixed(1)}%)</span>\r\n-            </li>\r\n-            <li className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\r\n+              <span className=\"font-medium\">{stats.original_percent.toFixed(1)}%</span>\r\n+            </div>\r\n+            <div className=\"flex justify-between\">\r\n               <span className=\"flex items-center\">\r\n                 <span className=\"w-3 h-3 rounded-full bg-yellow-500 mr-2\"></span>\r\n                 Paraphrased\r\n               </span>\r\n-              <span className=\"font-medium\">{stats.paraphrased_count} ({stats.paraphrased_percent.toFixed(1)}%)</span>\r\n-            </li>\r\n-            <li className=\"flex justify-between items-center p-2 bg-gray-50 rounded\">\r\n+              <span className=\"font-medium\">{stats.paraphrased_percent.toFixed(1)}%</span>\r\n+            </div>\r\n+            <div className=\"flex justify-between\">\r\n               <span className=\"flex items-center\">\r\n                 <span className=\"w-3 h-3 rounded-full bg-red-500 mr-2\"></span>\r\n                 Direct Match\r\n               </span>\r\n-              <span className=\"font-medium\">{stats.direct_count} ({stats.direct_percent.toFixed(1)}%)</span>\r\n-            </li>\r\n-            <li className=\"flex justify-between items-center p-2 border-t mt-2\">\r\n-              <span className=\"font-semibold\">Total Sentences</span>\r\n-              <span className=\"font-semibold\">{stats.total_sentences}</span>\r\n-            </li>\r\n-          </ul>\r\n+              <span className=\"font-medium\">{stats.direct_percent.toFixed(1)}%</span>\r\n+            </div>\r\n+          </div>\r\n         </div>\r\n+\r\n+        {/* Text Stats Section */}\r\n+        <div className=\"md:col-span-2 bg-gray-50 p-6 rounded-lg\">\r\n+          <h3 className=\"text-xl font-semibold mb-4\">Summary</h3>\r\n+          <div className=\"space-y-3\">\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"text-gray-600\">Total Sentences:</span>\r\n+              <span className=\"font-bold text-gray-800\">{stats.total_sentences}</span>\r\n+            </div>\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"text-gray-600\">Original Sentences:</span>\r\n+              <span className=\"font-bold text-green-600\">{stats.original_count}</span>\r\n+            </div>\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"text-gray-600\">Paraphrased Sentences:</span>\r\n+              <span className=\"font-bold text-yellow-600\">{stats.paraphrased_count}</span>\r\n+            </div>\r\n+            <div className=\"flex justify-between\">\r\n+              <span className=\"text-gray-600\">Direct Match Sentences:</span>\r\n+              <span className=\"font-bold text-red-600\">{stats.direct_count}</span>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n       </div>\r\n-\r\n-      {/* Visual Report */}\r\n-      <VisualReport\r\n-        structuredText={full_text_structured}\r\n-        onRewrite={onRewrite}\r\n-      />\r\n+      \r\n+      {/* Visual Report (this is our existing component) */}\r\n+      {full_text_structured && (\r\n+        <VisualReport structuredText={full_text_structured} />\r\n+      )}\r\n     </div>\r\n   );\r\n };\r\n \r\n"
                }
            ],
            "date": 1762593304616,
            "name": "Commit-0",
            "content": "import React from 'react';\r\nimport jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport VisualReport from './VisualReport'; // Import our new component\r\n\r\n// This component ONLY displays the results.\r\n// It receives the 'result' and 'file' objects as props.\r\nconst AnalysisReport = ({ result, file }) => {\r\n\r\n    const handleDownloadPDF = () => {\r\n        if (!result) return;\r\n\r\n        const doc = new jsPDF();\r\n        const user = JSON.parse(localStorage.getItem('user'));\r\n        \r\n        doc.setFont('helvetica', 'bold');\r\n        doc.setFontSize(20);\r\n        doc.text('Plagiarism Analysis Report', 105, 20, { align: 'center' });\r\n\r\n        doc.setFont('helvetica', 'normal');\r\n        doc.setFontSize(12);\r\n        doc.text(`Report for: ${user?.name || 'User'}`, 14, 35);\r\n        doc.text(`Analyzed File: ${file?.name || 'N/A'}`, 14, 42);\r\n        doc.text(`Date: ${new Date().toLocaleDateString()}`, 14, 49);\r\n\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.text('Overall Similarity Score:', 14, 60);\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.setTextColor(211, 47, 47); // Red color\r\n        doc.setFontSize(16);\r\n        doc.text(`${result.overall_score}%`, 75, 60);\r\n        \r\n        doc.setTextColor(0, 0, 0); // Reset color\r\n        doc.setFontSize(12);\r\n\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.text('Flagged Sections:', 14, 75);\r\n\r\n        const tableColumn = [\"Similarity\", \"Type\", \"Flagged Text\", \"Source\"];\r\n        const tableRows = [];\r\n\r\n        result.flagged_sections.forEach(section => {\r\n            const row = [\r\n                `${section.similarity}%`,\r\n                section.type,\r\n                section.text,\r\n                section.source\r\n            ];\r\n            tableRows.push(row);\r\n        });\r\n\r\n        autoTable(doc, {\r\n            startY: 80,\r\n            head: [tableColumn],\r\n            body: tableRows,\r\n            theme: 'striped',\r\n            headStyles: { fillColor: [41, 128, 185] }, // Blue header\r\n        });\r\n\r\n        doc.addPage();\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.setFontSize(16);\r\n        doc.text('Full Submitted Text', 14, 20);\r\n        \r\n        doc.setFont('helvetica', 'normal');\r\n        doc.setFontSize(9);\r\n        const splitText = doc.splitTextToSize(result.full_text, 180);\r\n        doc.text(splitText, 14, 30);\r\n\r\n        doc.save(`Plagiarism_Report_${file?.name || 'analysis'}.pdf`);\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white p-6 rounded-lg shadow-md\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-2xl font-semibold\">Analysis Report</h2>\r\n                <button\r\n                    onClick={handleDownloadPDF}\r\n                    className=\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700\"\r\n                >\r\n                    Download Report (PDF)\r\n                </button>\r\n            </div>\r\n            <div className=\"mb-6 border-b pb-4\">\r\n                <span className=\"text-gray-600 font-medium\">Overall Similarity Score:</span>\r\n                <span className=\"ml-2 text-3xl font-bold text-red-600\">{result.overall_score}%</span>\r\n            </div>\r\n            \r\n            {/* Render the new VisualReport component */}\r\n            {result.full_text_structured && (\r\n                <VisualReport structuredText={result.full_text_structured} />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AnalysisReport;"
        }
    ]
}