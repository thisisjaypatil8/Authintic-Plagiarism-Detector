{
    "sourceFile": "backend/middleware/authMiddleware.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1754123430964,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1754123442998,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,74 +0,0 @@\n-// backend/middleware/authMiddleware.js\r\n-\r\n-const jwt = require('jsonwebtoken');\r\n-\r\n-module.exports = function (req, res, next) {\r\n-    // Get token from header\r\n-    const token = req.header('x-auth-token');\r\n-\r\n-    // Check if not token\r\n-    if (!token) {\r\n-        return res.status(401).json({ msg: 'No token, authorization denied' });\r\n-    }\r\n-\r\n-    // Verify token\r\n-    try {\r\n-        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-        req.user = decoded.user;\r\n-        next();\r\n-    } catch (err) {\r\n-        res.status(401).json({ msg: 'Token is not valid' });\r\n-    }\r\n-};\r\n-```javascript\r\n-// backend/routes/document.js - UPDATED\r\n-\r\n-const express = require('express');\r\n-const multer = require('multer');\r\n-const fs = require('fs');\r\n-const axios = require('axios');\r\n-const router = express.Router();\r\n-const auth = require('../middleware/authMiddleware'); // 1. Import the middleware\r\n-\r\n-const upload = multer({ dest: 'uploads/' });\r\n-\r\n-// 2. Add the 'auth' middleware to protect the route\r\n-router.post('/upload', auth, upload.single('document'), async (req, res) => {\r\n-    if (!req.file) {\r\n-        return res.status(400).send('No file uploaded.');\r\n-    }\r\n-    try {\r\n-        const fileContent = fs.readFileSync(req.file.path, 'utf8');\r\n-        const nlpResponse = await axios.post('http://localhost:5001/analyze', {\r\n-            text: fileContent\r\n-        });\r\n-        fs.unlinkSync(req.file.path);\r\n-        res.status(200).json(nlpResponse.data);\r\n-    } catch (error) {\r\n-        console.error('Error calling NLP service:', error.message);\r\n-        res.status(500).send('Error analyzing the document.');\r\n-    }\r\n-});\r\n-\r\n-// 3. Add the 'auth' middleware to protect this route as well\r\n-router.post('/rewrite', auth, async (req, res) => {\r\n-    const { sentence } = req.body;\r\n-    if (!sentence) {\r\n-        return res.status(400).json({ msg: 'Sentence is required' });\r\n-    }\r\n-    try {\r\n-        const nlpResponse = await axios.post(\r\n-            `http://localhost:5001/rewrite`,\r\n-            {\r\n-                sentence: sentence,\r\n-                api_key: process.env.GEMINI_API_KEY \r\n-            }\r\n-        );\r\n-        res.json(nlpResponse.data);\r\n-    } catch (error) {\r\n-        console.error('Error proxying rewrite request:', error.message);\r\n-        res.status(500).send('Error rewriting the sentence.');\r\n-    }\r\n-});\r\n-\r\n-module.exports = router;\r\n\\ No newline at end of file\n"
                },
                {
                    "date": 1754124063192,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,22 @@\n-\n+// backend/middleware/authMiddleware.js\r\n+\r\n+const jwt = require('jsonwebtoken');\r\n+\r\n+module.exports = function (req, res, next) {\r\n+    // Get token from header\r\n+    const token = req.header('x-auth-token');\r\n+\r\n+    // Check if not token\r\n+    if (!token) {\r\n+        return res.status(401).json({ msg: 'No token, authorization denied' });\r\n+    }\r\n+\r\n+    // Verify token\r\n+    try {\r\n+        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n+        req.user = decoded.user;\r\n+        next();\r\n+    } catch (err) {\r\n+        res.status(401).json({ msg: 'Token is not valid' });\r\n+    }\r\n+};\r\n"
                }
            ],
            "date": 1754123430964,
            "name": "Commit-0",
            "content": "// backend/middleware/authMiddleware.js\r\n\r\nconst jwt = require('jsonwebtoken');\r\n\r\nmodule.exports = function (req, res, next) {\r\n    // Get token from header\r\n    const token = req.header('x-auth-token');\r\n\r\n    // Check if not token\r\n    if (!token) {\r\n        return res.status(401).json({ msg: 'No token, authorization denied' });\r\n    }\r\n\r\n    // Verify token\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n        req.user = decoded.user;\r\n        next();\r\n    } catch (err) {\r\n        res.status(401).json({ msg: 'Token is not valid' });\r\n    }\r\n};\r\n```javascript\r\n// backend/routes/document.js - UPDATED\r\n\r\nconst express = require('express');\r\nconst multer = require('multer');\r\nconst fs = require('fs');\r\nconst axios = require('axios');\r\nconst router = express.Router();\r\nconst auth = require('../middleware/authMiddleware'); // 1. Import the middleware\r\n\r\nconst upload = multer({ dest: 'uploads/' });\r\n\r\n// 2. Add the 'auth' middleware to protect the route\r\nrouter.post('/upload', auth, upload.single('document'), async (req, res) => {\r\n    if (!req.file) {\r\n        return res.status(400).send('No file uploaded.');\r\n    }\r\n    try {\r\n        const fileContent = fs.readFileSync(req.file.path, 'utf8');\r\n        const nlpResponse = await axios.post('http://localhost:5001/analyze', {\r\n            text: fileContent\r\n        });\r\n        fs.unlinkSync(req.file.path);\r\n        res.status(200).json(nlpResponse.data);\r\n    } catch (error) {\r\n        console.error('Error calling NLP service:', error.message);\r\n        res.status(500).send('Error analyzing the document.');\r\n    }\r\n});\r\n\r\n// 3. Add the 'auth' middleware to protect this route as well\r\nrouter.post('/rewrite', auth, async (req, res) => {\r\n    const { sentence } = req.body;\r\n    if (!sentence) {\r\n        return res.status(400).json({ msg: 'Sentence is required' });\r\n    }\r\n    try {\r\n        const nlpResponse = await axios.post(\r\n            `http://localhost:5001/rewrite`,\r\n            {\r\n                sentence: sentence,\r\n                api_key: process.env.GEMINI_API_KEY \r\n            }\r\n        );\r\n        res.json(nlpResponse.data);\r\n    } catch (error) {\r\n        console.error('Error proxying rewrite request:', error.message);\r\n        res.status(500).send('Error rewriting the sentence.');\r\n    }\r\n});\r\n\r\nmodule.exports = router;\r\n"
        }
    ]
}